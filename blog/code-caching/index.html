<!doctype html><html lang=zh-CN><meta charset=utf-8><title>Code caching · V8</title><meta content="width=device-width,initial-scale=1" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=' js'</script><meta content="V8 now supports (byte)code caching, i.e. caching the result of JavaScript parsing + compilation." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li class=active><a href=/blog/ >博客</a><li><a href=/docs/ >文档</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>Code caching</h1><p class=meta>发布时间 <time datetime="2015-07-27 13:33:37" itemprop=datePublished title="2015-07-27 13:33:37">2015-07-27</time> · 标签： <a href=/blog/tags/internals/ class=tag>internals</a></header><div itemprop=articleBody><p>V8 uses <a href=https://en.wikipedia.org/wiki/Just-in-time_compilation>just-in-time compilation</a> (JIT) to execute JavaScript code. This means that immediately prior to running a script, it has to be parsed and compiled — which can cause considerable overhead. As we <a href=https://blog.chromium.org/2015/03/new-javascript-techniques-for-rapid.html>announced recently</a>, code caching is a technique that lessens this overhead. When a script is compiled for the first time, cache data is produced and stored. The next time V8 needs to compile the same script, even in a different V8 instance, it can use the cache data to recreate the compilation result instead of compiling from scratch. As a result the script is executed much sooner.<p>Code caching has been available since V8 version 4.2 and not limited to Chrome alone. It is exposed through V8’s API, so that every V8 embedder can take advantage of it. The <a href=https://chromium.googlesource.com/v8/v8.git/+/4.5.56/test/cctest/test-api.cc#21090>test case</a> used to exercise this feature serves as an example of how to use this API.<p>When a script is compiled by V8, cache data can be produced to speed up later compilations by passing <code>v8::ScriptCompiler::kProduceCodeCache</code> as an option. If the compilation succeeds, the cache data is attached to the source object and can be retrieved via <code>v8::ScriptCompiler::Source::GetCachedData</code>. It can then be persisted for later, for example by writing it to disk.<p>During later compilations, the previously produced cache data can be attached to the source object and passed <code>v8::ScriptCompiler::kConsumeCodeCache</code> as an option. This time, code will be produced much faster, as V8 bypasses compiling the code and deserializes it from the provided cache data.<p>Producing cache data comes at a certain computational and memory cost. For this reason, Chrome only produces cache data if the same script is seen at least twice within a couple of days. This way Chrome is able to turn script files into executable code twice as fast on average, saving users valuable time on each subsequent page load.</div><footer><div><picture><source srcset="/_img/avatars/yang-guo.avif, /_img/avatars/yang-guo@2x.avif 2x" type=image/avif><img alt="" height=96 loading=lazy src=/_img/avatars/yang-guo.jpg srcset="/_img/avatars/yang-guo@2x.jpg 2x" width=96></picture><p>作者：Yang Guo (<a href=https://twitter.com/hashseed>@hashseed</a>), Software Engineer.</div></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/blog/code-caching>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/blog/code-caching.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>