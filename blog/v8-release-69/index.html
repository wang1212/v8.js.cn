<!doctype html><html lang=zh-CN><meta charset=utf-8><title>V8 release v6.9 · V8</title><meta content="width=device-width,initial-scale=1" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=' js'</script><meta content="V8 v6.9 features reduced memory usage through embedded built-ins, faster WebAssembly startup through Liftoff, better DataView and WeakMap performance, and much more!" name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li class=active><a href=/blog/ >博客</a><li><a href=/docs/ >文档</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>V8 release v6.9</h1><p class=meta>发布时间 <time datetime="2018-08-07 13:33:37" itemprop=datePublished title="2018-08-07 13:33:37">2018-08-07</time> · 标签： <a href=/blog/tags/release/ class=tag>release</a></header><div itemprop=articleBody><p>Every six weeks, we create a new branch of V8 as part of our <a href=/docs/release-process>release process</a>. Each version is branched from V8’s Git master immediately before a Chrome Beta milestone. Today we’re pleased to announce our newest branch, <a href=https://chromium.googlesource.com/v8/v8.git/+log/branch-heads/6.9>V8 version 6.9</a>, which is in beta until its release in coordination with Chrome 69 Stable in several weeks. V8 v6.9 is filled with all sorts of developer-facing goodies. This post provides a preview of some of the highlights in anticipation of the release.<h2 id=memory-savings-through-embedded-built-ins>Memory savings through embedded built-ins <a href=#memory-savings-through-embedded-built-ins class=bookmark>#</a></h2><p>V8 ships with an extensive library of built-in functions. Examples are methods on built-in objects such as <code>Array.prototype.sort</code> and <code>RegExp.prototype.exec</code>, but also a wide range of internal functionality. Because their generation takes a long time, built-in functions are compiled at build-time and serialized into a <a href=/blog/custom-startup-snapshots>snapshot</a>, which is later deserialized at runtime to create the initial JavaScript heap state.<p>Built-in functions currently consume 700 KB in each Isolate (an Isolate roughly corresponds to a browser tab in Chrome). This is quite wasteful, and last year we began working on reducing this overhead. In V8 v6.4, we shipped <a href=/blog/lazy-deserialization>lazy deserialization</a>, ensuring that each Isolate only pays for the built-ins that it actually needs (but each Isolate still had its own copy).<p><a href=/blog/embedded-builtins>Embedded built-ins</a> go one step further. An embedded built-in is shared by all Isolates, and embedded into the binary itself instead of copied onto the JavaScript heap. This means that built-ins exist in memory only once regardless of how many Isolates are running, an especially useful property now that <a href=https://developers.google.com/web/updates/2018/07/site-isolation>Site Isolation</a> has been enabled by default. With embedded built-ins, we’ve seen a median <em>9% reduction of the V8 heap size</em> over the top 10k websites on x64. Of these sites, 50% save at least 1.2 MB, 30% save at least 2.1 MB, and 10% save 3.7 MB or more.<p>V8 v6.9 ships with support for embedded built-ins on x64 platforms. Other platforms will follow soon in upcoming releases. For more details, see our <a href=/blog/embedded-builtins>dedicated blog post</a>.<h2 id=performance>Performance <a href=#performance class=bookmark>#</a></h2><h3 id=liftoff%2C-webassembly%E2%80%99s-new-first-tier-compiler>Liftoff, WebAssembly’s new first-tier compiler <a href=#liftoff%2C-webassembly%E2%80%99s-new-first-tier-compiler class=bookmark>#</a></h3><p>WebAssembly got a new baseline compiler for much faster startup of complex websites with big WebAssembly modules (such as Google Earth and AutoCAD). Depending on the hardware we are seeing speedups of more than 10×. For more details, refer to <a href=/blog/liftoff>the detailed Liftoff blog post</a>.<figure><img alt="" height=256 loading=lazy src=/_img/v8-liftoff.svg width=256><figcaption>Logo for Liftoff, V8’s baseline compiler for WebAssembly</figcaption></figure><h3 id=faster-dataview-operations>Faster <code>DataView</code> operations <a href=#faster-dataview-operations class=bookmark>#</a></h3><p><a href=https://tc39.es/ecma262/#sec-dataview-objects><code>DataView</code></a> methods have been reimplemented in V8 Torque, which spares a costly call to C++ compared to the former runtime implementation. Moreover, we now inline calls to <code>DataView</code> methods when compiling JavaScript code in TurboFan, resulting in even better peak performance for hot code. Using <code>DataView</code>s is now as efficient as using <code>TypedArray</code>s, finally making <code>DataView</code>s a viable choice in performance-critical situations. We’ll be covering this in more detail in an upcoming blog post about <code>DataView</code>s, so stay tuned!<h3 id=faster-processing-of-weakmaps-during-garbage-collection>Faster processing of <code>WeakMap</code>s during garbage collection <a href=#faster-processing-of-weakmaps-during-garbage-collection class=bookmark>#</a></h3><p>V8 v6.9 reduces Mark-Compact garbage collection pause times by improving <code>WeakMap</code> processing. Concurrent and incremental marking are now able to process <code>WeakMap</code>s, whereas previously all this work was done in the final atomic pause of Mark-Compact GC. Since not all work can be moved outside of the pause, the GC now also does more work in parallel to further reduce pause times. These optimizations essentially halved the average pause time for Mark-Compact GCs in <a href=https://github.com/v8/web-tooling-benchmark>the Web Tooling Benchmark</a>.<p><code>WeakMap</code> processing uses a fixed-point iteration algorithm that can degrade to quadratic runtime behavior in certain cases. With the new release, V8 is now able to switch to another algorithm that is guaranteed to finish in linear time if the GC does not finish within a certain number of iterations. Previously, worst-case examples could be constructed that took the GC a few seconds to finish even with a relatively small heap, while the linear algorithm finishes within a few milliseconds.<h2 id=javascript-language-features>JavaScript language features <a href=#javascript-language-features class=bookmark>#</a></h2><p>V8 v6.9 supports <a href=/features/array-flat-flatmap><code>Array.prototype.flat</code> and <code>Array.prototype.flatMap</code></a>.<p><code>Array.prototype.flat</code> flattens a given array recursively up to the specified <code>depth</code>, which defaults to <code>1</code>:<pre class=language-js><code class=language-js><span class="token comment">// Flatten one level:</span><br><span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>array<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → [1, 2, [3]]</span><br><br><span class="token comment">// Flatten recursively until the array contains no more nested arrays:</span><br>array<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token number">Infinity</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → [1, 2, 3]</span></code></pre><p><code>Array.prototype.flatMap</code> is like <code>Array.prototype.map</code>, except it flattens the result into a new array.<pre class=language-js><code class=language-js><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → [2, 4, 3, 6, 4, 8]</span></code></pre><p>For more details, see <a href=/features/array-flat-flatmap>our <code>Array.prototype.{flat,flatMap}</code> explainer</a>.<h2 id=v8-api>V8 API <a href=#v8-api class=bookmark>#</a></h2><p>Please use <code>git log branch-heads/6.8..branch-heads/6.9 include/v8.h</code> to get a list of the API changes.<p>Developers with an <a href=/docs/source-code#using-git>active V8 checkout</a> can use <code>git checkout -b 6.9 -t branch-heads/6.9</code> to experiment with the new features in V8 v6.9. Alternatively you can <a href=https://www.google.com/chrome/browser/beta.html>subscribe to Chrome’s Beta channel</a> and try the new features out yourself soon.</div><footer><div><p>作者：the V8 team.</div><a href=https://twitter.com/v8js/status/1026825606003150848 class=retweet>Retweet this article!</a></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/blog/v8-release-69>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/blog/v8-release-69.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>