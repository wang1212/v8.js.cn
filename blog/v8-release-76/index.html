<!doctype html><html lang=zh-CN><meta charset=utf-8><title>V8 release v7.6 · V8</title><meta content="width=device-width,initial-scale=1" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=' js'</script><meta content="V8 v7.6 features Promise.allSettled, faster JSON.parse, localized BigInts, speedier frozen/sealed arrays, and much more!" name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li class=active><a href=/blog/ >博客</a><li><a href=/docs/ >文档</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>V8 release v7.6</h1><p class=meta>发布时间 <time datetime="2019-06-19 16:45:00" itemprop=datePublished title="2019-06-19 16:45:00">2019-06-19</time> · 标签： <a href=/blog/tags/release/ class=tag>release</a></header><div itemprop=articleBody><p>Every six weeks, we create a new branch of V8 as part of our <a href=/docs/release-process>release process</a>. Each version is branched from V8’s Git master immediately before a Chrome Beta milestone. Today we’re pleased to announce our newest branch, <a href=https://chromium.googlesource.com/v8/v8.git/+log/branch-heads/7.6>V8 version 7.6</a>, which is in beta until its release in coordination with Chrome 76 Stable in several weeks. V8 v7.6 is filled with all sorts of developer-facing goodies. This post provides a preview of some of the highlights in anticipation of the release.<h2 id=performance>Performance (size & speed) <a href=#performance class=bookmark>#</a></h2><h3 id=json.parse-improvements><code>JSON.parse</code> improvements <a href=#json.parse-improvements class=bookmark>#</a></h3><p>In modern JavaScript applications, JSON is commonly used as a format to communicate structured data. By speeding up JSON parsing, we can reduce the latency of this communication. In V8 v7.6, we’ve overhauled our JSON parser to be much faster at scanning and parsing JSON. This results in up to 2.7× faster parsing of data served by popular web pages.<figure><img alt="" height=371 loading=lazy src=/_img/v8-release-76/json-parsing.svg width=600><figcaption>Chart showing improved performance of <code>JSON.parse</code> on a variety of websites</figcaption></figure><p>Up to V8 v7.5, the JSON parser was a recursive parser that would use native stack space relative to the nesting depth of the incoming JSON data. This meant we could run out of stack for very deeply nested JSON data. V8 v7.6 switches to an iterative parser that manages its own stack, which is limited only by available memory.<p>The new JSON parser is also more memory-efficient. By buffering properties before we create the final object we can now decide how to allocate the result in an optimal way. For objects with named properties we allocate objects with the exact amount of space needed for the named properties in the incoming JSON data (up to 128 named properties). In case JSON objects contain indexed property names, we allocate an elements backing store that uses the minimal amount of space; either a flat array or a dictionary. JSON arrays are now parsed to an array that exactly fits the number of elements in the input data.<h3 id=frozen%2Fsealed-array-improvements>Frozen/sealed array improvements <a href=#frozen%2Fsealed-array-improvements class=bookmark>#</a></h3><p>Performance of calls on frozen or sealed arrays (and array-like objects) received numerous improvements. V8 v7.6 boosts the following JavaScript coding patterns, where <code>frozen</code> is a frozen or sealed array or array-like object:<ul><li><code>frozen.indexOf(v)</code><li><code>frozen.includes(v)</code><li>spread calls such as <code>fn(...frozen)</code><li>spread calls with a nested array spread such as <code>fn(...[...frozen])</code><li>apply calls with array spread such as <code>fn.apply(this, [...frozen])</code></ul><p>The chart below shows the improvements.<figure><img alt="" height=408 loading=lazy src=/_img/v8-release-76/frozen-sealed-elements.svg width=660><figcaption>Chart showing performance boost on a variety of array operations</figcaption></figure><p><a href=https://bit.ly/fast-frozen-sealed-elements-in-v8>See the “fast frozen & sealed elements in V8” design doc</a> for more details.<h3 id=unicode-string-handling>Unicode string handling <a href=#unicode-string-handling class=bookmark>#</a></h3><p>An optimization when <a href=https://chromium.googlesource.com/v8/v8/+/734c1456d942a03d79aab4b3b0e57afbc803ceea>converting strings to Unicode</a> resulted in a significant speed-up for calls such as <code>String#localeCompare</code>, <code>String#normalize</code>, and some of the <code>Intl</code> APIs. For example, this change resulted in around 2× the raw throughput of <code>String#localeCompare</code> for one-byte strings.<h2 id=javascript-language-features>JavaScript language features <a href=#javascript-language-features class=bookmark>#</a></h2><h3 id=promise.allsettled><code>Promise.allSettled</code> <a href=#promise.allsettled class=bookmark>#</a></h3><p><a href=/features/promise-combinators#promise.allsettled><code>Promise.allSettled(promises)</code></a> provides a signal when all the input promises are <em>settled</em>, which means they’re either <em>fulfilled</em> or <em>rejected</em>. This is useful in cases where you don’t care about the state of the promise, you just want to know when the work is done, regardless of whether it was successful. <a href=/features/promise-combinators>Our explainer on promise combinators</a> has more details and includes an example.<h3 id=localized-bigint>Improved <code>BigInt</code> support <a href=#localized-bigint class=bookmark>#</a></h3><p><a href=/features/bigint><code>BigInt</code></a> now has better API support in the language. You can now format a <code>BigInt</code> in a locale-aware manner by using the <code>toLocaleString</code> method. This works just like it does for regular numbers:<pre class=language-js><code class=language-js><span class="token number">12345678901234567890n</span><span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token string">'en'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🐌</span><br><span class="token comment">// → '12,345,678,901,234,567,890'</span><br><span class="token number">12345678901234567890n</span><span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token string">'de'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🐌</span><br><span class="token comment">// → '12.345.678.901.234.567.890'</span></code></pre><p>If you plan on formatting multiple numbers or <code>BigInt</code>s using the same locale, it’s more efficient to use the <code>Intl.NumberFormat</code> API, which now supports <code>BigInt</code>s in its <code>format</code> and <code>formatToParts</code> methods. This way, you can create a single re-usable formatter instance.<pre class=language-js><code class=language-js><span class="token keyword">const</span> nf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intl<span class="token punctuation">.</span>NumberFormat</span><span class="token punctuation">(</span><span class="token string">'fr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>nf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">12345678901234567890n</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🚀</span><br><span class="token comment">// → '12 345 678 901 234 567 890'</span><br>nf<span class="token punctuation">.</span><span class="token function">formatToParts</span><span class="token punctuation">(</span><span class="token number">123456n</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🚀</span><br><span class="token comment">// → [</span><br><span class="token comment">// →   { type: 'integer', value: '123' },</span><br><span class="token comment">// →   { type: 'group', value: ' ' },</span><br><span class="token comment">// →   { type: 'integer', value: '456' }</span><br><span class="token comment">// → ]</span></code></pre><h3 id=intl-datetimeformat><code>Intl.DateTimeFormat</code> improvements <a href=#intl-datetimeformat class=bookmark>#</a></h3><p>Apps commonly display date intervals or date ranges to show the span of an event, such as a hotel reservation, the billing period of a service, or a music festival. The <code>Intl.DateTimeFormat</code> API now supports <code>formatRange</code> and <code>formatRangeToParts</code> methods to conveniently format date ranges in a locale-specific manner.<pre class=language-js><code class=language-js><span class="token keyword">const</span> start <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'2019-05-07T09:20:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → 'May 7, 2019'</span><br><span class="token keyword">const</span> end <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'2019-05-09T16:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → 'May 9, 2019'</span><br><span class="token keyword">const</span> fmt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intl<span class="token punctuation">.</span>DateTimeFormat</span><span class="token punctuation">(</span><span class="token string">'en'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>  year<span class="token operator">:</span> <span class="token string">'numeric'</span><span class="token punctuation">,</span><br>  month<span class="token operator">:</span> <span class="token string">'long'</span><span class="token punctuation">,</span><br>  day<span class="token operator">:</span> <span class="token string">'numeric'</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> output <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">formatRange</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → 'May 7 – 9, 2019'</span><br><span class="token keyword">const</span> parts <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">formatRangeToParts</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → [</span><br><span class="token comment">// →   { 'type': 'month',   'value': 'May',  'source': 'shared' },</span><br><span class="token comment">// →   { 'type': 'literal', 'value': ' ',    'source': 'shared' },</span><br><span class="token comment">// →   { 'type': 'day',     'value': '7',    'source': 'startRange' },</span><br><span class="token comment">// →   { 'type': 'literal', 'value': ' – ',  'source': 'shared' },</span><br><span class="token comment">// →   { 'type': 'day',     'value': '9',    'source': 'endRange' },</span><br><span class="token comment">// →   { 'type': 'literal', 'value': ', ',   'source': 'shared' },</span><br><span class="token comment">// →   { 'type': 'year',    'value': '2019', 'source': 'shared' },</span><br><span class="token comment">// → ]</span></code></pre><p>Additionally, the <code>format</code>, <code>formatToParts</code>, and <code>formatRangeToParts</code> methods now support the new <code>timeStyle</code> and <code>dateStyle</code> options:<pre class=language-js><code class=language-js><span class="token keyword">const</span> dtf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intl<span class="token punctuation">.</span>DateTimeFormat</span><span class="token punctuation">(</span><span class="token string">'de'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>  timeStyle<span class="token operator">:</span> <span class="token string">'medium'</span><span class="token punctuation">,</span><br>  dateStyle<span class="token operator">:</span> <span class="token string">'short'</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>dtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '19.06.19, 13:33:37'</span></code></pre><h2 id=native-stack-walking>Native stack walking <a href=#native-stack-walking class=bookmark>#</a></h2><p>While V8 can walk its own call stack (e.g. when debugging or profiling in the DevTools), the Windows operating system was unable to walk a call stack that contains code generated by TurboFan when running on the x64 architecture. This could cause <em>broken stacks</em> when using native debuggers or ETW sampling to analyze processes that use V8. A recent change enables V8 to <a href=https://chromium.googlesource.com/v8/v8/+/3cda21de77d098a612eadf44d504b188a599c5f0>register the necessary metadata</a> for Windows to be able to walk these stacks on x64, and in v7.6 this is enabled by default.<h2 id=v8-api>V8 API <a href=#v8-api class=bookmark>#</a></h2><p>Please use <code>git log branch-heads/7.5..branch-heads/7.6 include/v8.h</code> to get a list of the API changes.<p>Developers with an <a href=/docs/source-code#using-git>active V8 checkout</a> can use <code>git checkout -b 7.6 -t branch-heads/7.6</code> to experiment with the new features in V8 v7.6. Alternatively you can <a href=https://www.google.com/chrome/browser/beta.html>subscribe to Chrome’s Beta channel</a> and try the new features out yourself soon.</div><footer><div><picture><source srcset="/_img/avatars/adam-klein.avif, /_img/avatars/adam-klein@2x.avif 2x" type=image/avif><img alt="" height=96 loading=lazy src=/_img/avatars/adam-klein.jpg width=96 srcset="/_img/avatars/adam-klein@2x.jpg 2x"></picture><p>作者：Adam Klein.</div><a href=https://twitter.com/v8js/status/1141356209179516930 class=retweet>Retweet this article!</a></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/blog/v8-release-76>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/blog/v8-release-76.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>