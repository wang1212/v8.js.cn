<!doctype html><html lang=zh-CN><meta charset=utf-8><title>V8 v7.2 发布 · V8</title><meta content="width=device-width,initial-scale=1" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=' js'</script><meta content="V8 v7.2 features high-speed JavaScript parsing, faster async-await, reduced memory consumption on ia32, public class fields, and much more!" name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li class=active><a href=/blog/ >博客</a><li><a href=/docs/ >文档</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>V8 v7.2 发布</h1><p class=meta>发布时间 <time datetime="2018-12-18 11:48:21" itemprop=datePublished title="2018-12-18 11:48:21">2018-12-18</time> · 标签： <a href=/blog/tags/release/ class=tag>release</a></header><div itemprop=articleBody><p>每六周，我们会按照 <a href=/docs/release-process>V8 的发布流程</a>创建一个新的 V8 分支。在进入 Chrome Beta 里程碑之前，此版本从 V8 的 master 分支创建出来。今天我们很高兴地宣布当前最新的分支异常创建出来了，<a href=https://chromium.googlesource.com/v8/v8.git/+log/branch-heads/7.2>V8 version 7.2</a>，它将在几个星期内与 Chrome 72 Stable 同时发布。V8 v7.2 包含了各种面向开发者的新特性。这篇文章提供了预期发布的一些功能亮点。<h2 id=memory>内存 <a href=#memory class=bookmark>#</a></h2><p>现在基于 ia32 架构的平台已经默认开启了对<a href=/blog/embedded-builtins>将内置函数直接以二进制方式嵌入</a>的支持。<h2 id=performance>性能 <a href=#performance class=bookmark>#</a></h2><h3 id=javascript-parsing>JavaScript 解析 <a href=#javascript-parsing class=bookmark>#</a></h3><p>平均而言，网页在启动时 V8 用来解析 JavaScript 所花费的时间占了 9.5%。因此，我们在 v7.2 版本中更加专注于为 V8 提供更快的 JavaScript 解析器。我们全面提高了解析速度。从 v7.0 开始，用于桌面的解析速度提高了大约 30%。过去几个月我们对 Facebook 加载网页进行了基准测试，下图显示了解析时间的显着改进。<figure><img alt="" height=223 src=/_img/v8-release-72/facebook-parse-time.png width=1060 loading=lazy srcset="/_img/v8-release-72/facebook-parse-time@2x.png 2x"><figcaption>V8 在 facebook.com 的解析时间(越低表示越好)</figcaption></figure><p>我们不仅针对 Facebook，我们的解析器可以用在各种不同的场景下，都有显著的性能提升。下图显示了几个热门网站上最新 v7.2 版本的改进。<figure><img alt="" height=354 src=/_img/v8-release-72/relative-parse-times.svg width=861 loading=lazy><figcaption>V8 v7.2 解析时间的提升(越低表示越好)</figcaption></figure><p>总而言之，这次改进将平均解析占比从 9.5% 降低到了 7.5%，从而缩短了加载时间，并提高了响应速度。<h3 id=async%2Fawait><code>async</code>/<code>await</code> <a href=#async%2Fawait class=bookmark>#</a></h3><p>V8 v7.2 带来了<a href=/blog/fast-async#await-under-the-hood>更快的 <code>async</code>/<code>await</code> 实现</a>，默认开启。我们提交了<a href=https://github.com/tc39/ecma262/pull/1250>规范提案</a>，收集了一些 Web 兼容性数据，并且已经正式合并到 ECMAScript 规范中。<h3 id=spread-elements>元素展开语法 <a href=#spread-elements class=bookmark>#</a></h3><p>当元素展开（spread elements）出现在数组字面量前面时，V8 V7.2 极大地提高了元素展开的性能，例如 <code>[...x]</code> 或 <code>[...x, 1, 2]</code>。这种改进适用于数组展开，原始字符串，Set，Map keys，Map values，这一切都得益于 <code>Array.from(x)</code>。有关更多详细信息，请参阅我们<a href=/blog/spread-elements>深入理解如何加速元素展开的文章</a>。<h3 id=webassembly>WebAssembly <a href=#webassembly class=bookmark>#</a></h3><p>我们分析了许多 WebAssembly 基准测试，并使用它们来指导执行层中的代码生成。尤其是 V8 v7.2 优化了编译器的调度程序和后端循环的 node 拆分。我们还改进了包装器缓存并引入了自定义包装器，以减少导入 JavaScript 的 math 函数的开销。此外，我们设计了对寄存器分配器的更改，以改善某些代码模式（code patterns）的性能，这些代码模式将在更高版本中出现。<h3 id=trap-handlers>Trap handlers <a href=#trap-handlers class=bookmark>#</a></h3><p>Trap handlers 正在改进 WebAssembly 代码的吞吐量。它们在 V8 v7.2 中的 Windows，macOS 和 Linux 上已经可用。在 Chromium 中，它们在 Linux 上启用。当确认稳定性时，Windows 和 macOS 将会效仿。我们目前正致力于在 Android 上提供它们。<h2 id=async-stack-traces>异步堆栈跟踪 <a href=#async-stack-traces class=bookmark>#</a></h2><p>正如<a href=/blog/fast-async#improved-developer-experience>之前所提到的</a>，我们增加了一个所谓的新功能：<a href=https://bit.ly/v8-zero-cost-async-stack-traces>zero-cost async stack traces</a>，丰富了异步调用中 <code>error.stack</code> 的调用栈信息。此特性目前可使用 <code>--async-stack-traces</code> 命令行标志开启。<h2 id=javascript-language-features>JavaScript 语言特性 <a href=#javascript-language-features class=bookmark>#</a></h2><h3 id=public-class-fields>Public class fields <a href=#public-class-fields class=bookmark>#</a></h3><p>V8 v7.2 增加了对 <a href=/features/class-fields>public class fields</a> 的支持。用来代替：<pre class=language-js><code class=language-js><span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span><br>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span><br>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>likesBaths <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token function">meow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Meow!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>......现在，你可以这样写：<pre class=language-js><code class=language-js><span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span><br>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span><br>  likesBaths <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>  <span class="token function">meow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Meow!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>计划在未来的 V8 版本中支持 <a href=/features/class-fields#private-class-fields>private class fields</a>。<h3 id=intl.listformat><code>Intl.ListFormat</code> <a href=#intl.listformat class=bookmark>#</a></h3><p>V8 v7.2 增加了对 <a href=/features/intl-listformat><code>Intl.ListFormat</code> 提案</a>的支持，实现了列表的本地化格式。<pre class=language-js><code class=language-js><span class="token keyword">const</span> lf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intl<span class="token punctuation">.</span>ListFormat</span><span class="token punctuation">(</span><span class="token string">'en'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>lf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Frank'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → 'Frank'</span><br>lf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Frank'</span><span class="token punctuation">,</span> <span class="token string">'Christine'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → 'Frank and Christine'</span><br>lf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Frank'</span><span class="token punctuation">,</span> <span class="token string">'Christine'</span><span class="token punctuation">,</span> <span class="token string">'Flora'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → 'Frank, Christine, and Flora'</span><br>lf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Frank'</span><span class="token punctuation">,</span> <span class="token string">'Christine'</span><span class="token punctuation">,</span> <span class="token string">'Flora'</span><span class="token punctuation">,</span> <span class="token string">'Harrison'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → 'Frank, Christine, Flora, and Harrison'</span></code></pre><p>有关更多信息和用法示例，请查看我们的 <a href=/features/intl-listformat>Web 基础知识：<code>Intl.ListFormat</code></a>。<h3 id=well-formed-json.stringify>Well-formed <code>JSON.stringify</code> <a href=#well-formed-json.stringify class=bookmark>#</a></h3><p>在之前的 <code>JSON.stringify</code> 规范中，如果输入中包含了任何的单独代理(Lone surrogates)，会返回格式错误的 Unicode 字符串（以及 UTF-8 表示形式）：<pre class=language-js><code class=language-js><span class="token comment">// Old behavior:</span><br><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">'\uD800'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '"�"'</span><br><br><span class="token comment">// New behavior:</span><br><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">'\uD800'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '"\\ud800"'</span></code></pre><p>V8 现在实现了一个 <a href=/features/well-formed-json-stringify>stage 3 提案</a>，该提议改变了 <code>JSON.stringify</code> 输出含有单独代理(Lone surrogates)的转义序列的方式，使其输出有效的 Unicode（并以 UTF-8 表示）：<p>请注意，<code>JSON.parse(stringified)</code> 的运行结果仍然和以前一样。<h3 id=module-namespace-exports>Module namespace exports <a href=#module-namespace-exports class=bookmark>#</a></h3><p>在 <a href=/features/modules>JavaScript 模块</a> 中，已经可以使用以下语法：<pre class=language-js><code class=language-js><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> utils <span class="token keyword">from</span> <span class="token string">'./utils.mjs'</span><span class="token punctuation">;</span></code></pre><p>但是，之前没有对应的 <code>export</code>语法...... <a href=/features/module-namespace-exports>直到现在</a>：<pre class=language-js><code class=language-js><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">as</span> utils <span class="token keyword">from</span> <span class="token string">'./utils.mjs'</span><span class="token punctuation">;</span></code></pre><p>这相当于以下内容：<pre class=language-js><code class=language-js><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> utils <span class="token keyword">from</span> <span class="token string">'./utils.mjs'</span><span class="token punctuation">;</span><br><span class="token keyword">export</span> <span class="token punctuation">{</span> utils <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h2 id=v8-api>V8 API <a href=#v8-api class=bookmark>#</a></h2><p>请使用 <code>git log branch-heads/7.1..branch-heads/7.2 include/v8.h</code> 获取 API 的变更列表。<p>开发者可以使用 <code>git checkout -b 7.2 -t branch-heads/7.2</code> 来使用 V8 v7.2 中的实验性新功能，具体请参阅<a href=/docs/source-code#using-git>使用 Git 获取 V8 源码</a>。或者，您可以订阅 <a href=https://www.google.com/chrome/browser/beta.html>Chrome 的 Beta 频道</a> 来尽快尝试新功能。</div><footer><div><picture><source srcset="/_img/avatars/andreas-haas.avif, /_img/avatars/andreas-haas@2x.avif 2x" type=image/avif><img alt="" height=96 src=/_img/avatars/andreas-haas.jpg width=96 loading=lazy srcset="/_img/avatars/andreas-haas@2x.jpg 2x"></picture><p>作者：Andreas Haas, handler of traps.</div><a href=https://twitter.com/v8js/status/1074978755934863361 class=retweet>Retweet this article!</a></footer><footer><div><img alt="" height=96 src=/_img/avatars/justjavac.jpg width=96 srcset="/_img/avatars/justjavac@2x.jpg 2x" lazyload=on><p>译者：迷渡 (<a href=https://github.com/justjavac>@justjavac</a>)，V8.js.cn 站长.</div></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/blog/v8-release-72>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/blog/v8-release-72.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>