<!doctype html><html lang=zh-CN><meta charset=utf-8><title>V8 release v8.6 · V8</title><meta content="width=device-width,initial-scale=1" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=' js'</script><meta content="V8 release v8.6 brings respectful code, performance improvements, and normative changes." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li class=active><a href=/blog/ >博客</a><li><a href=/docs/ >文档</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>V8 release v8.6</h1><p class=meta>发布时间 <time datetime="2020-09-21 00:00:00" itemprop=datePublished title="2020-09-21 00:00:00">2020-09-21</time> · 标签： <a href=/blog/tags/release/ class=tag>release</a></header><div itemprop=articleBody><p>Every six weeks, we create a new branch of V8 as part of our <a href=https://v8.dev/docs/release-process>release process</a>. Each version is branched from V8’s Git master immediately before a Chrome Beta milestone. Today we’re pleased to announce our newest branch, <a href=https://chromium.googlesource.com/v8/v8.git/+log/branch-heads/8.6>V8 version 8.6</a>, which is in beta until its release in coordination with Chrome 86 Stable in several weeks. V8 v8.6 is filled with all sorts of developer-facing goodies. This post provides a preview of some of the highlights in anticipation of the release.<h2 id=respectful-code>Respectful code <a href=#respectful-code class=bookmark>#</a></h2><p>The v8.6 version makes the V8 code base <a href=https://v8.dev/docs/respectful-code>more respectful</a>. The team joined a Chromium-wide effort to follow Google’s commitments to racial equity by replacing some insensitive terms in the project. This is still an ongoing effort and any external contributor is welcome to give a hand! You can see the list of still available tasks <a href=https://docs.google.com/document/d/1rK7NQK64c53-qbEG-N5xz7uY_QUVI45sUxinbyikCYM/edit>here</a>.<h2 id=javascript>JavaScript <a href=#javascript class=bookmark>#</a></h2><h3 id=open-sourced-js-fuzzer>Open sourced JS-Fuzzer <a href=#open-sourced-js-fuzzer class=bookmark>#</a></h3><p>JS-Fuzzer is a mutation-based JavaScript fuzzer originally authored by Oliver Chang. It has been a cornerstone of V8's <a href="https://bugs.chromium.org/p/chromium/issues/list?q=ochang_js_fuzzer%20label%3AStability-Crash%20label%3AClusterfuzz%20-status%3AWontFix%20-status%3ADuplicate&can=1">stability</a> and <a href="https://bugs.chromium.org/p/chromium/issues/list?q=ochang_js_fuzzer%20label%3ASecurity%20label%3AClusterfuzz%20-status%3AWontFix%20-status%3ADuplicate&can=1">security</a> in the past and is now <a href=https://chromium-review.googlesource.com/c/v8/v8/+/2320330>open source</a>.<p>The fuzzer mutates existing cross-engine test cases using <a href=https://babeljs.io/ >Babel</a> AST transformations configured by extensible <a href=https://chromium.googlesource.com/v8/v8/+/320d98709f/tools/clusterfuzz/js_fuzzer/mutators/ >mutator classes</a>. We recently also started running an instance of the fuzzer in differential-testing mode for detecting JavaScript <a href="https://bugs.chromium.org/p/chromium/issues/list?q=blocking%3A1050674%20-status%3ADuplicate&can=1">correctness issues</a>. Contributions are welcome! See the <a href=https://chromium.googlesource.com/v8/v8/+/master/tools/clusterfuzz/js_fuzzer/README.md>README</a> for more.<h3 id=speed-ups-in-number.prototype.tostring>Speed-ups in <code>Number.prototype.toString</code> <a href=#speed-ups-in-number.prototype.tostring class=bookmark>#</a></h3><p>Converting a JavaScript number to a string can be a surprisingly complex operation in the general case; we have to take into account floating point precision, scientific notation, NaNs, infinities, rounding, and so on. We don’t even know how big the resulting string will be before calculating it. Because of this, our implementation of <code>Number.prototype.toString</code> would bail out to a C++ runtime function.<p>But, a lot of the time, you just want to print a simple, small integer (a “Smi”). This is a much simpler operation, and the overheads of calling a C++ runtime function are no longer worth it. So we’ve worked with our friends at Microsoft to add a simple fast path for small integers to <code>Number.prototype.toString</code>, written in Torque, to reduce these overheads for this common case. This improved number printing microbenchmarks by ~75%.<h3 id=atomics.wake-removed><code>Atomics.wake</code> removed <a href=#atomics.wake-removed class=bookmark>#</a></h3><p><code>Atomics.wake</code> was renamed to <code>Atomics.notify</code> to match a spec change <a href=https://v8.dev/blog/v8-release-73#atomics.notify>in v7.3</a>. The deprecated <code>Atomics.wake</code> alias is now removed.<h3 id=small-normative-changes>Small normative changes <a href=#small-normative-changes class=bookmark>#</a></h3><ul><li>Anonymous classes now have a <code>.name</code> property whose value is the empty string <code>''</code>. <a href=https://github.com/tc39/ecma262/pull/1490>Spec change</a>.<li>The <code>\8</code> and <code>\9</code> escape sequences are now illegal in template string literals in <a href=https://developer.mozilla.org/en-US/docs/Glossary/Sloppy_mode>sloppy mode</a> and in all string literals in <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode>strict mode</a>. <a href=https://github.com/tc39/ecma262/pull/2054>Spec change</a>.<li>The built-in <code>Reflect</code> object now has a <code>Symbol.toStringTag</code> property whose value is <code>'Reflect'</code>. <a href=https://github.com/tc39/ecma262/pull/2057>Spec change</a>.</ul><h2 id=webassembly>WebAssembly <a href=#webassembly class=bookmark>#</a></h2><h3 id=simd-on-liftoff>SIMD on Liftoff <a href=#simd-on-liftoff class=bookmark>#</a></h3><p>Liftoff is the baseline compiler for WebAssembly, and as of V8 v8.5 is shipped on all platforms. The <a href=https://v8.dev/features/simd>SIMD proposal</a> enables WebAssembly to take advantage of commonly available hardware vector instructions to accelerate compute-intensive workloads. It is currently in an <a href=https://v8.dev/blog/v8-release-84#simd-origin-trial>Origin Trial</a>, which allows developers to experiment with a feature before it is standardized.<p>Up until now, SIMD was implemented only in TurboFan, V8's top tier compiler. This is necessary to get maximum performance out of the SIMD instructions. WebAssembly modules that use SIMD instructions will have faster startup, and often faster runtime performance than their scalar equivalents compiled with TurboFan. For example, given a function that takes an array of floats and clamps its values to zero (written here in JavaScript for clarity):<pre class=language-js><code class=language-js><span class="token keyword">function</span> <span class="token function">clampZero</span><span class="token punctuation">(</span><span class="token parameter">f32array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> f32array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>f32array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      f32array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>Let’s compare two different implementations of this function, using Liftoff and TurboFan:<ol><li>A scalar implementation, with the loop unrolled 4 times.<li>A SIMD implementation, using the <code>i32x4.max_s</code> instruction.</ol><p>Using the Liftoff scalar implementation as a baseline, we see the following results:<figure><img alt="" height=371 loading=lazy src=/_img/v8-release-86/simd.svg width=600><figcaption>A graph showing Liftoff SIMD being ~2.8× faster than Liftoff scalar vs. TurboFan SIMD being ~7.5× faster</figcaption></figure><h3 id=faster-wasm-to-js-calls>Faster Wasm-to-JS calls <a href=#faster-wasm-to-js-calls class=bookmark>#</a></h3><p>If WebAssembly calls an imported JavaScript function, we call through a so-called “Wasm-to-JS wrapper” (or “import wrapper”). This wrapper <a href=https://webassembly.github.io/spec/js-api/index.html#tojsvalue>translates the arguments</a> to objects that JavaScript understands, and when the call to JavaScript returns, it translates back the return value(s) <a href=https://webassembly.github.io/spec/js-api/index.html#towebassemblyvalue>to WebAssembly</a>.<p>In order to ensure that the JavaScript <code>arguments</code> object reflects exactly the arguments that were passed from WebAssembly, we call through a so-called “arguments adapter trampoline” if a mismatch in the number of arguments is detected.<p>In many cases though, this is not needed, because the called function does not use the <code>arguments</code> object. In v8.6, we landed a <a href=https://crrev.com/c/2317061>patch</a> by our Microsoft contributors that avoids the call through the arguments adapter in those cases, which makes affected calls significantly faster.<h2 id=v8-api>V8 API <a href=#v8-api class=bookmark>#</a></h2><h3 id=detect-pending-background-tasks-with-isolate%3A%3Ahaspendingbackgroundtasks>Detect pending background tasks with <code>Isolate::HasPendingBackgroundTasks</code> <a href=#detect-pending-background-tasks-with-isolate%3A%3Ahaspendingbackgroundtasks class=bookmark>#</a></h3><p>The new API function <code>Isolate::HasPendingBackgroundTasks</code> allows embedders to check if there is pending background work that will eventually post new foreground tasks, like WebAssembly compilation.<p>This API should solve the problem where an embedder shuts down V8 even though there is still pending WebAssembly compilation that will eventually kick off further script execution. With <code>Isolate::HasPendingBackgroundTasks</code> the embedder can wait for new foreground tasks instead of shutting down V8.<p>Please use <code>git log branch-heads/8.5..branch-heads/8.6 include/v8.h</code> to get a list of the API changes.<p>Developers with an active V8 checkout can use <code>git checkout -b 8.6 -t branch-heads/8.6</code> to experiment with the new features in V8 v8.6. Alternatively you can <a href=https://www.google.com/chrome/browser/beta.html>subscribe to Chrome’s Beta channel</a> and try the new features out yourself soon.</div><footer><div><picture><source srcset="/_img/avatars/ingvar-stepanyan.avif, /_img/avatars/ingvar-stepanyan@2x.avif 2x" type=image/avif><img alt="" height=96 loading=lazy src=/_img/avatars/ingvar-stepanyan.jpg width=96 srcset="/_img/avatars/ingvar-stepanyan@2x.jpg 2x"></picture><p>作者：Ingvar Stepanyan (<a href=https://twitter.com/RReverser>@RReverser</a>), a keyboard fuzzer.</div><a href=https://twitter.com/v8js/status/1308062287731789825 class=retweet>Retweet this article!</a></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/blog/v8-release-86>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/blog/v8-release-86.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>