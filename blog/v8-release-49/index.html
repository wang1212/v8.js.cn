<!doctype html><html lang=zh-CN><meta charset=utf-8><title>V8 release v4.9 · V8</title><meta content="width=device-width,initial-scale=1" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=' js'</script><meta content="V8 v4.9 comes with an improved `Math.random` implementation and adds support for several new ES2015 language features." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li class=active><a href=/blog/ >博客</a><li><a href=/docs/ >文档</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>V8 release v4.9</h1><p class=meta>发布时间 <time datetime="2016-01-26 13:33:37" itemprop=datePublished title="2016-01-26 13:33:37">2016-01-26</time> · 标签： <a href=/blog/tags/release/ class=tag>release</a></header><div itemprop=articleBody><p>Roughly every six weeks, we create a new branch of V8 as part of our <a href=/docs/release-process>release process</a>. Each version is branched from V8’s Git master immediately before Chrome branches for a Chrome Beta milestone. Today we’re pleased to announce our newest branch, <a href=https://chromium.googlesource.com/v8/v8.git/+log/branch-heads/4.9>V8 version 4.9</a>, which will be in beta until it is released in coordination with Chrome 49 Stable. V8 4.9 is filled with all sorts of developer-facing goodies, so we’d like to give you a preview of some of the highlights in anticipation of the release in several weeks.<h2 id=91%25-ecmascript-2015-(es6)-support>91% ECMAScript 2015 (ES6) support <a href=#91%25-ecmascript-2015-(es6)-support class=bookmark>#</a></h2><p>In V8 release 4.9 we shipped more JavaScript ES2015 features than in any other previous release, bringing us to 91% completion as measured by the <a href=https://kangax.github.io/compat-table/es6/ >Kangax compatibility table</a> (as of January 26). V8 now supports destructuring, default parameters, Proxy objects, and the Reflect API. Release 4.9 also makes block level constructs such as <code>class</code> and <code>let</code> available outside of strict mode and adds support for the sticky flag on regular expressions and customizable <code>Object.prototype.toString</code> output.<h3 id=destructuring>Destructuring <a href=#destructuring class=bookmark>#</a></h3><p>Variable declarations, parameters, and assignments now support <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment>destructuring</a> of objects and arrays via patterns. For example:<pre class=language-js><code class=language-js><span class="token keyword">const</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token punctuation">{</span>p<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token punctuation">{</span>q<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token punctuation">{</span>p<span class="token punctuation">}</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">}</span> <span class="token operator">=</span> o<span class="token punctuation">;</span>              <span class="token comment">// x=1, y=2, p=4, c={q: 5}</span><br><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span><span class="token punctuation">;</span>                                <span class="token comment">// x=2, y=1</span><br><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>a<span class="token punctuation">,</span> b<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><br><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                      <span class="token comment">// [4, undefined]</span></code></pre><p>Array patterns can contain rest patterns that are assigned the remainder of the array:<pre class=language-js><code class=language-js><span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">...</span>r<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>              <span class="token comment">// x=1, y=2, r=[3,4]</span></code></pre><p>Furthermore, pattern elements can be given default values, which are used in case the respective property has no match:<pre class=language-js><code class=language-js><span class="token keyword">const</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> x<span class="token punctuation">,</span> b<span class="token operator">:</span> y <span class="token operator">=</span> x<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">;</span>                <span class="token comment">// x=4, y=4</span><br><span class="token comment">// or…</span><br><span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> z <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>               <span class="token comment">// x=1, y=2, z=0</span></code></pre><p>Destructuring can be used to make accessing data from objects and arrays more compact.<h3 id=proxies-%26-reflect>Proxies & Reflect <a href=#proxies-%26-reflect class=bookmark>#</a></h3><p>After years of development, V8 now ships with a complete implementation of <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy>proxies</a>, up-to-date with the ES2015 spec. Proxies are a powerful mechanism for virtualizing objects and functions through a set of developer-provided hooks to customize property accesses. In addition to object virtualization, proxies can be used to implement interception, add validation for property setting, simplify debugging and profiling, and unlock advanced abstractions like <a href=http://tvcutsem.github.io/js-membranes/ >membranes</a>.<p>To proxy an object, you must create a handler placeholder object that defines various traps and apply it to the target object which the proxy virtualizes:<pre class=language-js><code class=language-js><span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'world'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">Hello, </span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>name<span class="token punctuation interpolation-punctuation">}</span></span><span class="token string">!</span><span class="token string template-punctuation">`</span></span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span><br>foo<span class="token punctuation">.</span>bar<span class="token punctuation">;</span><br><span class="token comment">// → 'Hello, bar!'</span></code></pre><p>The Proxy object is accompanied by the Reflect module, which defines suitable defaults for all proxy traps:<pre class=language-js><code class=language-js><span class="token keyword">const</span> debugMe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>  <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> name<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">Debug: get called for field: </span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>name<span class="token punctuation interpolation-punctuation">}</span></span><span class="token string template-punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> name<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> name<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">Debug: set called for field: </span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>name<span class="token punctuation interpolation-punctuation">}</span></span><span class="token string">, and value: </span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>value<span class="token punctuation interpolation-punctuation">}</span></span><span class="token string template-punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> name<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>debugMe<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'John Doe'</span><span class="token punctuation">;</span><br><span class="token comment">// Debug: set called for field: name, and value: John Doe</span><br><span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">Mr. </span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>debugMe<span class="token punctuation">.</span>name<span class="token punctuation interpolation-punctuation">}</span></span><span class="token string template-punctuation">`</span></span><span class="token punctuation">;</span> <span class="token comment">// → 'Mr. John Doe'</span><br><span class="token comment">// Debug: get called for field: name</span></code></pre><p>For more information on the usage of Proxies and the Reflect API, see the examples section of the <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy#Examples>MDN Proxy page</a>.<h3 id=default-parameters>Default parameters <a href=#default-parameters class=bookmark>#</a></h3><p>In ES5 and below, optional parameters in function definitions required boilerplate code to check whether parameters were undefined:<pre class=language-js><code class=language-js><span class="token keyword">function</span> <span class="token function">sublist</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> start <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> end <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> end <span class="token operator">=</span> list<span class="token punctuation">.</span>length<span class="token punctuation">;</span><br>  <span class="token operator">...</span><br><span class="token punctuation">}</span></code></pre><p>ES2015 now allows function parameters to have <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Default_parameters>default values</a>, providing for clearer and more succinct function definitions:<pre class=language-js><code class=language-js><span class="token keyword">function</span> <span class="token function">sublist</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> end <span class="token operator">=</span> list<span class="token punctuation">.</span>length</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> … <span class="token punctuation">}</span><br><span class="token function">sublist</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// sublist([1, 2, 3], 1, 3)</span></code></pre><p>Default parameters and destructuring can be combined, of course:<pre class=language-js><code class=language-js><span class="token keyword">function</span> <span class="token function">vector</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> … <span class="token punctuation">}</span></code></pre><h3 id=classes-%26-lexical-declarations-in-sloppy-mode>Classes & lexical declarations in sloppy mode <a href=#classes-%26-lexical-declarations-in-sloppy-mode class=bookmark>#</a></h3><p>V8 has supported lexical declarations (<code>let</code>, <code>const</code>, block-local <code>function</code>) and classes since versions 4.1 and 4.2 respectively, but so far strict mode has been required in order to use them. As of V8 release 4.9, all of these features are now enabled outside of strict mode as well, per the ES2015 spec. This makes prototyping in the DevTools Console much easier, although we encourage developers in general to upgrade to strict mode for new code.<h3 id=regular-expressions>Regular expressions <a href=#regular-expressions class=bookmark>#</a></h3><p>V8 now supports the new <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/sticky>sticky flag</a> on regular expressions. The sticky flag toggles whether searches in strings start from the beginning of the string (normal) or from the <code>lastIndex</code> property (sticky). This behavior is useful for efficiently parsing arbitrarily long input strings with many different regular expressions. To enable sticky searching, add the <code>y</code> flag to a regex: (e.g. <code>const regex = /foo/y;</code>).<h3 id=customizable-object.prototype.tostring-output>Customizable <code>Object.prototype.toString</code> output <a href=#customizable-object.prototype.tostring-output class=bookmark>#</a></h3><p>Using <code>Symbol.toStringTag</code>, user-defined types can now return customized output when passed to <code>Object.prototype.toString</code> (either directly or as a result of string coercion):<pre class=language-js><code class=language-js><span class="token keyword">class</span> <span class="token class-name">Custom</span> <span class="token punctuation">{</span><br>  <span class="token keyword">get</span> <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token string">'Custom'</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Custom</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '[object Custom]'</span><br><span class="token function">String</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Custom</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '[object Custom]'</span></code></pre><h2 id=improved-math.random()>Improved <code>Math.random()</code> <a href=#improved-math.random() class=bookmark>#</a></h2><p>V8 v4.9 includes an improvement in the implementation of <code>Math.random()</code>. <a href=/blog/math-random>As announced last month</a>, we switched V8’s PRNG algorithm to <a href=http://vigna.di.unimi.it/ftp/papers/xorshiftplus.pdf>xorshift128+</a> in order to provide higher-quality pseudo-randomness.<h2 id=v8-api>V8 API <a href=#v8-api class=bookmark>#</a></h2><p>Please check out our <a href=https://docs.google.com/document/d/1g8JFi8T_oAE_7uAri7Njtig7fKaPDfotU6huOa1alds/edit>summary of API changes</a>. This document gets regularly updated a few weeks after each major release.<p>Developers with an <a href=https://v8.dev/docs/source-code#using-git>active V8 checkout</a> can use <code>git checkout -b 4.9 -t branch-heads/4.9</code> to experiment with the new features in V8 v4.9. Alternatively you can subscribe to <a href=https://www.google.com/chrome/browser/beta.html>Chrome's Beta channel</a> and try the new features out yourself soon.</div><footer><div><p>作者：the V8 team.</div></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/blog/v8-release-49>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/blog/v8-release-49.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>