<!doctype html><html lang=zh-CN><meta charset=utf-8><title>Temporarily disabling escape analysis · V8</title><meta content="width=device-width,initial-scale=1" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=' js'</script><meta content="We’ve disabled V8’s escape analysis in Chrome 61 to protect users against a security vulnerability." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li class=active><a href=/blog/ >博客</a><li><a href=/docs/ >文档</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>Temporarily disabling escape analysis</h1><p class=meta>发布时间 <time datetime="2017-09-22 13:33:37" itemprop=datePublished title="2017-09-22 13:33:37">2017-09-22</time> · 标签： <a href=/blog/tags/security/ class=tag>security</a></header><div itemprop=articleBody><p>In JavaScript, an allocated object <em>escapes</em> if it is accessible from outside the current function. Normally V8 allocates new objects on the JavaScript heap, but using <em>escape analysis</em>, an optimizing compiler can figure out when an object can be treated specially because its lifetime is provably bound to the function’s activation. When the reference to a newly allocated object does not escape the function that creates it, JavaScript engines don’t need to explicitly allocate that object on the heap. They can instead effectively treat the values of the object as local variables to the function. That in turn enables all kinds of optimizations like storing these values on the stack or in registers, or in some cases, optimizing the values away completely. Objects that escape (more accurately, objects that can’t be proven to not escape) must be heap-allocated.<p>For example, escape analysis enables V8 to effectively rewrite the following code:<pre class=language-js><code class=language-js><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> object <span class="token operator">=</span> <span class="token punctuation">{</span> a<span class="token punctuation">,</span> b <span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> object<span class="token punctuation">.</span>a <span class="token operator">+</span> object<span class="token punctuation">.</span>b<span class="token punctuation">;</span><br>  <span class="token comment">// Note: `object` does not escape.</span><br><span class="token punctuation">}</span></code></pre><p>…into this code, which enables several under-the-hood optimizations:<pre class=language-js><code class=language-js><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> object_a <span class="token operator">=</span> a<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> object_b <span class="token operator">=</span> b<span class="token punctuation">;</span><br>  <span class="token keyword">return</span> object_a <span class="token operator">+</span> object_b<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>V8 v6.1 and older used an escape analysis implementation that was complex and generated many bugs since its introduction. This implementation has since been removed and a brand new escape analysis codebase is available in <a href=/blog/v8-release-62>V8 v6.2</a>.<p>However, <a href=https://chromereleases.googleblog.com/2017/09/stable-channel-update-for-desktop_21.html>a Chrome security vulnerability</a> involving the old escape analysis implementation in V8 v6.1 has been discovered and responsibly disclosed to us. To protect our users, we’ve turned off escape analysis in Chrome 61. Node.js should not be affected as the exploit depends on execution of untrusted JavaScript.<p>Turning off escape analysis negatively impacts performance because it disables the abovementioned optimizations. Specifically, the following ES2015 features might suffer temporary slowdowns:<ul><li>destructuring<li><code>for</code>-<code>of</code> iteration<li>array spread<li>rest parameters</ul><p>Note that disabling escape analysis is only a temporary measure. With Chrome 62, we’ll ship the brand new — and most importantly, enabled — implementation of escape analysis as seen in V8 v6.2.</div><footer><div><picture><source srcset="/_img/avatars/mathias-bynens.avif, /_img/avatars/mathias-bynens@2x.avif 2x" type=image/avif><img alt="" height=96 loading=lazy src=/_img/avatars/mathias-bynens.jpg srcset="/_img/avatars/mathias-bynens@2x.jpg 2x" width=96></picture><p>作者：Mathias Bynens (<a href=https://twitter.com/mathias>@mathias</a>), sandbox escape analyzer.</div><a href=https://twitter.com/v8js/status/911339802884284416 class=retweet>Retweet this article!</a></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/blog/disabling-escape-analysis>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/blog/disabling-escape-analysis.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>