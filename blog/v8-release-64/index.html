<!doctype html><html lang=zh-CN><meta charset=utf-8><title>V8 release v6.4 · V8</title><meta content="width=device-width,initial-scale=1" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=' js'</script><meta content="V8 v6.4 includes performance improvements, new JavaScript language features, and more." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li class=active><a href=/blog/ >博客</a><li><a href=/docs/ >文档</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>V8 release v6.4</h1><p class=meta>发布时间 <time datetime="2017-12-19 13:33:37" itemprop=datePublished title="2017-12-19 13:33:37">2017-12-19</time> · 标签： <a href=/blog/tags/release/ class=tag>release</a></header><div itemprop=articleBody><p>Every six weeks, we create a new branch of V8 as part of our <a href=/docs/release-process>release process</a>. Each version is branched from V8’s Git master immediately before a Chrome Beta milestone. Today we’re pleased to announce our newest branch, <a href=https://chromium.googlesource.com/v8/v8.git/+log/branch-heads/6.4>V8 version 6.4</a>, which is in beta until its release in coordination with Chrome 64 Stable in several weeks. V8 v6.4 is filled with all sorts of developer-facing goodies. This post provides a preview of some of the highlights in anticipation of the release.<h2 id=speed>Speed <a href=#speed class=bookmark>#</a></h2><p>V8 v6.4 <a href="https://bugs.chromium.org/p/v8/issues/detail?id=6971">improves</a> the performance of the <code>instanceof</code> operator by 3.6×. As a direct result, <a href=http://lisperator.net/uglifyjs/ >uglify-js</a> is now 15–20% faster according to <a href=https://github.com/v8/web-tooling-benchmark>V8’s Web Tooling Benchmark</a>.<p>This release also addresses some performance cliffs in <code>Function.prototype.bind</code>. For example, TurboFan now <a href="https://bugs.chromium.org/p/v8/issues/detail?id=6946">consistently inlines</a> all monomorphic calls to <code>bind</code>. In addition, TurboFan also supports the <em>bound callback pattern</em>, meaning that instead of the following:<pre class=language-js><code class=language-js><span class="token function">doSomething</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> someObj<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>You can now use:<pre class=language-js><code class=language-js><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>someObj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>This way, the code is more readable, and you still get the same performance.<p>Thanks to <a href=https://twitter.com/peterwmwong>Peter Wong</a>’s latest contributions, <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap><code>WeakMap</code></a> and <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakSet><code>WeakSet</code></a> are now implemented using the <a href=/blog/csa>CodeStubAssembler</a>, resulting in performance improvements of up to 5× across the board.<figure><img alt="" height=375 loading=lazy src=/_img/v8-release-64/weak-collection.svg width=625></figure><p>As part of V8’s <a href="https://bugs.chromium.org/p/v8/issues/detail?id=1956">on-going effort</a> to improve the performance of array built-ins, we improved <code>Array.prototype.slice</code> performance ~4× by reimplementing it using the CodeStubAssembler. Additionally, calls to <code>Array.prototype.map</code> and <code>Array.prototype.filter</code> are now inlined for many cases, giving them a performance profile competitive with hand-written versions.<p>We worked to make out-of-bounds loads in arrays, typed arrays, and strings <a href="https://bugs.chromium.org/p/v8/issues/detail?id=7027">no longer incur a ~10× performance hit</a> after noticing <a href=/blog/elements-kinds#avoid-reading-beyond-length>this coding pattern</a> being used in the wild.<h2 id=memory>Memory <a href=#memory class=bookmark>#</a></h2><p>V8’s built-in code objects and bytecode handlers are now deserialized lazily from the snapshot, which can significantly reduce memory consumed by each Isolate. Benchmarks in Chrome show savings of several hundred KB per tab when browsing common sites.<figure><img alt="" height=371 loading=lazy src=/_img/v8-release-64/codespace-consumption.svg width=600></figure><p>Look out for a dedicated blog post on this subject early next year.<h2 id=ecmascript-language-features>ECMAScript language features <a href=#ecmascript-language-features class=bookmark>#</a></h2><p>This V8 release includes support for two new exciting regular expression features.<p>In regular expressions with the <code>/u</code> flag, <a href=https://mathiasbynens.be/notes/es-unicode-property-escapes>Unicode property escapes</a> are now enabled by default.<pre class=language-js><code class=language-js><span class="token keyword">const</span> regexGreekSymbol <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token language-regex regex-source">\p{Script_Extensions=Greek}</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span><span class="token punctuation">;</span><br>regexGreekSymbol<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'π'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → true</span></code></pre><p>Support for <a href=https://developers.google.com/web/updates/2017/07/upcoming-regexp-features#named_captures>named capture groups</a> in regular expressions is now enabled by default.<pre class=language-js><code class=language-js><span class="token keyword">const</span> pattern <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token language-regex regex-source">(?&lt;year>\d{4})-(?&lt;month>\d{2})-(?&lt;day>\d{2})</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span><span class="token punctuation">;</span><br><span class="token keyword">const</span> result <span class="token operator">=</span> pattern<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'2017-12-15'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// result.groups.year === '2017'</span><br><span class="token comment">// result.groups.month === '12'</span><br><span class="token comment">// result.groups.day === '15'</span></code></pre><p>More details about these features are available in our blog post titled <a href=https://developers.google.com/web/updates/2017/07/upcoming-regexp-features>Upcoming regular expression features</a>.<p>Thanks to <a href=https://twitter.com/GrouponEng>Groupon</a>, V8 now implements <a href=https://github.com/tc39/proposal-import-meta><code>import.meta</code></a>, which enables embedders to expose host-specific metadata about the current module. For example, Chrome 64 exposes the module URL via <code>import.meta.url</code>, and Chrome plans to add more properties to <code>import.meta</code> in the future.<p>To assist with local-aware formatting of strings produced by internationalization formatters, developers can now use <a href=https://github.com/tc39/proposal-intl-formatToParts><code>Intl.NumberFormat.prototype.formatToParts()</code></a> to format a number to a list of tokens and their type. Thanks to <a href=https://twitter.com/igalia>Igalia</a> for implementing this in V8!<h2 id=v8-api>V8 API <a href=#v8-api class=bookmark>#</a></h2><p>Please use <code>git log branch-heads/6.3..branch-heads/6.4 include/v8.h</code> to get a list of the API changes.<p>Developers with an <a href=/docs/source-code#using-git>active V8 checkout</a> can use <code>git checkout -b 6.4 -t branch-heads/6.4</code> to experiment with the new features in V8 v6.4. Alternatively you can <a href=https://www.google.com/chrome/browser/beta.html>subscribe to Chrome’s Beta channel</a> and try the new features out yourself soon.</div><footer><div><p>作者：the V8 team.</div><a href=https://twitter.com/v8js/status/943057597481082880 class=retweet>Retweet this article!</a></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/blog/v8-release-64>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/blog/v8-release-64.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>