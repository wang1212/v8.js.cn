<!doctype html><html lang=zh-CN><meta charset=utf-8><title>Getting started with embedding V8 · V8</title><meta content="width=device-width,initial-scale=1" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=' js'</script><meta content="This document introduces some key V8 concepts and provides a “hello world” example to get you started with V8 code." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li><a href=/blog/ >博客</a><li class=active><a href=/docs/ >文档</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><h1>Getting started with embedding V8</h1><p>This document introduces some key V8 concepts and provides a “hello world” example to get you started with V8 code.<h2 id=audience>Audience <a href=#audience class=bookmark>#</a></h2><p>This document is intended for C++ programmers who want to embed the V8 JavaScript engine within a C++ application. It helps you to make your own application’s C++ objects and methods available to JavaScript, and to make JavaScript objects and functions available to your C++ application.<h2 id=hello-world>Hello world <a href=#hello-world class=bookmark>#</a></h2><p>Let’s look at a <a href=https://chromium.googlesource.com/v8/v8/+/branch-heads/6.8/samples/hello-world.cc>Hello World example</a> that takes a JavaScript statement as a string argument, executes it as JavaScript code, and prints the result to standard out.<p>First, some key concepts:<ul><li>An isolate is a VM instance with its own heap.<li>A local handle is a pointer to an object. All V8 objects are accessed using handles. They are necessary because of the way the V8 garbage collector works.<li>A handle scope can be thought of as a container for any number of handles. When you've finished with your handles, instead of deleting each one individually you can simply delete their scope.<li>A context is an execution environment that allows separate, unrelated, JavaScript code to run in a single instance of V8. You must explicitly specify the context in which you want any JavaScript code to be run.</ul><p>These concepts are discussed in greater detail in <a href=/docs/embed#advanced-guide>the advanced guide</a>.<h2 id=run-the-example>Run the example <a href=#run-the-example class=bookmark>#</a></h2><p>Follow the steps below to run the example yourself:<ol><li><p>Download the V8 source code by following <a href=/docs/source-code#using-git>the Git instructions</a>.<li><p>The instructions for this hello world example have last been tested with V8 v7.1.11. You can check out this branch with <code>git checkout refs/tags/7.1.11 -b sample -t</code><li><p>Create a build configuration using the helper script:<pre class=language-bash><code class=language-bash>tools/dev/v8gen.py x64.release.sample</code></pre><p>You can inspect and manually edit the build configuration by running:<pre class=language-bash><code class=language-bash>gn args out.gn/x64.release.sample</code></pre><li><p>Build the static library on a Linux 64 system:<pre class=language-bash><code class=language-bash>ninja -C out.gn/x64.release.sample v8_monolith</code></pre><li><p>Compile <code>hello-world.cc</code>, linking to the static library created in the build process. For example, on 64bit Linux using the GNU compiler:<pre class=language-bash><code class=language-bash>g++ -I. -Iinclude samples/hello-world.cc -o hello_world -lv8_monolith -Lout.gn/x64.release.sample/obj/ -pthread -std<span class="token operator">=</span>c++0x -DV8_COMPRESS_POINTERS</code></pre><li><p>For more complex code, V8 fails without an ICU data file. Copy this file to where your binary is stored:<pre class=language-bash><code class=language-bash><span class="token function">cp</span> out.gn/x64.release.sample/icudtl.dat <span class="token class-name builtin">.</span></code></pre><li><p>Run the <code>hello_world</code> executable file at the command line. e.g. On Linux, in the V8 directory, run:<pre class=language-bash><code class=language-bash>./hello_world</code></pre><li><p>It prints <code>Hello, World!</code>. Yay!</ol><p>If you are looking for an example which is in sync with master, check out the file <a href=https://chromium.googlesource.com/v8/v8/+/master/samples/hello-world.cc><code>hello-world.cc</code></a>. This is a very simple example and you’ll likely want to do more than just execute scripts as strings. <a href=#advanced-guide>The advanced guide below</a> contains more information for V8 embedders.<h2 id=more-example-code>More example code <a href=#more-example-code class=bookmark>#</a></h2><p>The following samples are provided as part of the source code download.<h3 id=process.cc><a href=https://github.com/v8/v8/blob/master/samples/process.cc><code>process.cc</code></a> <a href=#process.cc class=bookmark>#</a></h3><p>This sample provides the code necessary to extend a hypothetical HTTP request processing application — which could be part of a web server, for example — so that it is scriptable. It takes a JavaScript script as an argument, which must provide a function called <code>Process</code>. The JavaScript <code>Process</code> function can be used to, for example, collect information such as how many hits each page served by the fictional web server gets.<h3 id=shell.cc><a href=https://github.com/v8/v8/blob/master/samples/shell.cc><code>shell.cc</code></a> <a href=#shell.cc class=bookmark>#</a></h3><p>This sample takes filenames as arguments then reads and executes their contents. Includes a command prompt at which you can enter JavaScript code snippets which are then executed. In this sample additional functions like <code>print</code> are also added to JavaScript through the use of object and function templates.<h2 id=advanced-guide>Advanced guide <a href=#advanced-guide class=bookmark>#</a></h2><p>Now that you’re familiar with using V8 as a standalone virtual machine and with some key V8 concepts such as handles, scopes, and contexts, let’s discuss these concepts further and introduce a few other concepts that are key to embedding V8 within your own C++ application.<p>The V8 API provides functions for compiling and executing scripts, accessing C++ methods and data structures, handling errors, and enabling security checks. Your application can use V8 just like any other C++ library. Your C++ code accesses V8 through the V8 API by including the header <code>include/v8.h</code>.<h3 id=handles-and-garbage-collection>Handles and garbage collection <a href=#handles-and-garbage-collection class=bookmark>#</a></h3><p>A handle provides a reference to a JavaScript object’s location in the heap. The V8 garbage collector reclaims memory used by objects that can no longer again be accessed. During the garbage collection process the garbage collector often moves objects to different locations in the heap. When the garbage collector moves an object the garbage collector also updates all handles that refer to the object with the object’s new location.<p>An object is considered garbage if it is inaccessible from JavaScript and there are no handles that refer to it. From time to time the garbage collector removes all objects considered to be garbage. V8’s garbage collection mechanism is key to V8’s performance.<p>There are several types of handles:<ul><li><p>Local handles are held on a stack and are deleted when the appropriate destructor is called. These handles’ lifetime is determined by a handle scope, which is often created at the beginning of a function call. When the handle scope is deleted, the garbage collector is free to deallocate those objects previously referenced by handles in the handle scope, provided they are no longer accessible from JavaScript or other handles. This type of handle is used in the hello world example above.<p>Local handles have the class <code>Local&lt;SomeType></code>.<p><strong>Note:</strong> The handle stack is not part of the C++ call stack, but the handle scopes are embedded in the C++ stack. Handle scopes can only be stack-allocated, not allocated with <code>new</code>.<li><p>Persistent handles provide a reference to a heap-allocated JavaScript Object, just like a local handle. There are two flavors, which differ in the lifetime management of the reference they handle. Use a persistent handle when you need to keep a reference to an object for more than one function call, or when handle lifetimes do not correspond to C++ scopes. Google Chrome, for example, uses persistent handles to refer to Document Object Model (DOM) nodes. A persistent handle can be made weak, using <code>PersistentBase::SetWeak</code>, to trigger a callback from the garbage collector when the only references to an object are from weak persistent handles.<ul><li>A <code>UniquePersistent&lt;SomeType></code> handle relies on C++ constructors and destructors to manage the lifetime of the underlying object.<li>A <code>Persistent&lt;SomeType></code> can be constructed with its constructor, but must be explicitly cleared with <code>Persistent::Reset</code>.</ul><li><p>There are other types of handles which are rarely used, that we will only briefly mention here:<ul><li><code>Eternal</code> is a persistent handle for JavaScript objects that are expected to never be deleted. It is cheaper to use because it relieves the garbage collector from determining the liveness of that object.<li>Both <code>Persistent</code> and <code>UniquePersistent</code> cannot be copied, which makes them unsuitable as values with pre-C++11 standard library containers. <code>PersistentValueMap</code> and <code>PersistentValueVector</code> provide container classes for persistent values, with map and vector-like semantics. C++11 embedders do not require these, since C++11 move semantics solve the underlying problem.</ul></ul><p>Of course, creating a local handle every time you create an object can result in a lot of handles! This is where handle scopes are very useful. You can think of a handle scope as a container that holds lots of handles. When the handle scope’s destructor is called all handles created within that scope are removed from the stack. As you would expect, this results in the objects to which the handles point being eligible for deletion from the heap by the garbage collector.<p>Returning to <a href=#hello-world>our very simple hello world example</a>, in the following diagram you can see the handle-stack and heap-allocated objects. Note that <code>Context::New()</code> returns a <code>Local</code> handle, and we create a new <code>Persistent</code> handle based on it to demonstrate the usage of <code>Persistent</code> handles.<figure><img alt="" height=292 loading=lazy src=/_img/docs/embed/local-persist-handles-review.png width=748></figure><p>When the destructor <code>HandleScope::~HandleScope</code> is called, the handle scope is deleted. Objects referred to by handles within the deleted handle scope are eligible for removal in the next garbage collection if there are no other references to them. The garbage collector can also remove the <code>source_obj</code>, and <code>script_obj</code> objects from the heap as they are no longer referenced by any handles or otherwise reachable from JavaScript. Since the context handle is a persistent handle, it is not removed when the handle scope is exited. The only way to remove the context handle is to explicitly call <code>Reset</code> on it.<div class=note><p><strong>Note:</strong> Throughout this document the term “handle” refers to a local handle. When discussing a persistent handle, that term is used in full.</div><p>It is important to be aware of one common pitfall with this model: <em>you cannot return a local handle directly from a function that declares a handle scope</em>. If you do the local handle you’re trying to return will end up being deleted by the handle scope’s destructor immediately before the function returns. The proper way to return a local handle is construct an <code>EscapableHandleScope</code> instead of a <code>HandleScope</code> and to call the <code>Escape</code> method on the handle scope, passing in the handle whose value you want to return. Here’s an example of how that works in practice:<pre class=language-cpp><code class=language-cpp><span class="token comment">// This function returns a new array with three elements, x, y, and z.</span><br>Local<span class="token operator">&lt;</span>Array<span class="token operator">></span> <span class="token function">NewPointArray</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> z<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  v8<span class="token operator">::</span>Isolate<span class="token operator">*</span> isolate <span class="token operator">=</span> v8<span class="token operator">::</span><span class="token class-name">Isolate</span><span class="token operator">::</span><span class="token function">GetCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// We will be creating temporary handles so we use a handle scope.</span><br>  v8<span class="token operator">::</span>EscapableHandleScope <span class="token function">handle_scope</span><span class="token punctuation">(</span>isolate<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Create a new empty array.</span><br>  v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>v8<span class="token operator">::</span>Array<span class="token operator">></span> array <span class="token operator">=</span> v8<span class="token operator">::</span><span class="token class-name">Array</span><span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Return an empty result if there was an error creating the array.</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">.</span><span class="token function">IsEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token keyword">return</span> v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>v8<span class="token operator">::</span>Array<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Fill out the values</span><br>  array<span class="token operator">-></span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  array<span class="token operator">-></span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  array<span class="token operator">-></span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Return the value through Escape.</span><br>  <span class="token keyword">return</span> handle_scope<span class="token punctuation">.</span><span class="token function">Escape</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>The <code>Escape</code> method copies the value of its argument into the enclosing scope, deletes all its local handles, and then gives back the new handle copy which can safely be returned.<h3 id=contexts>Contexts <a href=#contexts class=bookmark>#</a></h3><p>In V8, a context is an execution environment that allows separate, unrelated, JavaScript applications to run in a single instance of V8. You must explicitly specify the context in which you want any JavaScript code to be run.<p>Why is this necessary? Because JavaScript provides a set of built-in utility functions and objects that can be changed by JavaScript code. For example, if two entirely unrelated JavaScript functions both changed the global object in the same way then unexpected results are fairly likely to happen.<p>In terms of CPU time and memory, it might seem an expensive operation to create a new execution context given the number of built-in objects that must be built. However, V8’s extensive caching ensures that, while the first context you create is somewhat expensive, subsequent contexts are much cheaper. This is because the first context needs to create the built-in objects and parse the built-in JavaScript code while subsequent contexts only have to create the built-in objects for their context. With the V8 snapshot feature (activated with build option <code>snapshot=yes</code>, which is the default) the time spent creating the first context will be highly optimized as a snapshot includes a serialized heap which contains already compiled code for the built-in JavaScript code. Along with garbage collection, V8’s extensive caching is also key to V8’s performance.<p>When you have created a context you can enter and exit it any number of times. While you are in context A you can also enter a different context, B, which means that you replace A as the current context with B. When you exit B then A is restored as the current context. This is illustrated below:<figure><img alt="" height=484 loading=lazy src=/_img/docs/embed/intro-contexts.png width=417></figure><p>Note that the built-in utility functions and objects of each context are kept separate. You can optionally set a security token when you create a context. See the <a href=#security-model>Security Model</a> section for more information.<p>The motivation for using contexts in V8 was so that each window and iframe in a browser can have its own fresh JavaScript environment.<h3 id=templates>Templates <a href=#templates class=bookmark>#</a></h3><p>A template is a blueprint for JavaScript functions and objects in a context. You can use a template to wrap C++ functions and data structures within JavaScript objects so that they can be manipulated by JavaScript scripts. For example, Google Chrome uses templates to wrap C++ DOM nodes as JavaScript objects and to install functions in the global namespace. You can create a set of templates and then use the same ones for every new context you make. You can have as many templates as you require. However you can only have one instance of any template in any given context.<p>In JavaScript there is a strong duality between functions and objects. To create a new type of object in Java or C++ you would typically define a new class. In JavaScript you create a new function instead, and create instances using the function as a constructor. The layout and functionality of a JavaScript object is closely tied to the function that constructed it. This is reflected in the way V8 templates work. There are two types of templates:<ul><li><p>Function templates<p>A function template is the blueprint for a single function. You create a JavaScript instance of the template by calling the template’s <code>GetFunction</code> method from within the context in which you wish to instantiate the JavaScript function. You can also associate a C++ callback with a function template which is called when the JavaScript function instance is invoked.<li><p>Object templates<p>Each function template has an associated object template. This is used to configure objects created with this function as their constructor. You can associate two types of C++ callbacks with object templates:<ul><li>accessor callbacks are invoked when a specific object property is accessed by a script<li>interceptor callbacks are invoked when any object property is accessed by a script</ul><p><a href=#accessors>Accessors</a> and <a href=#interceptors>interceptors</a> are discussed later in this document.</ul><p>The following code provides an example of creating a template for the global object and setting the built-in global functions.<pre class=language-cpp><code class=language-cpp><span class="token comment">// Create a template for the global object and set the</span><br><span class="token comment">// built-in global functions.</span><br>v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>v8<span class="token operator">::</span>ObjectTemplate<span class="token operator">></span> global <span class="token operator">=</span> v8<span class="token operator">::</span><span class="token class-name">ObjectTemplate</span><span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>isolate<span class="token punctuation">)</span><span class="token punctuation">;</span><br>global<span class="token operator">-></span><span class="token function">Set</span><span class="token punctuation">(</span>v8<span class="token operator">::</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">NewFromUtf8</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> <span class="token string">"log"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            v8<span class="token operator">::</span><span class="token class-name">FunctionTemplate</span><span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> LogCallback<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Each processor gets its own context so different processors</span><br><span class="token comment">// do not affect each other.</span><br>v8<span class="token operator">::</span>Persistent<span class="token operator">&lt;</span>v8<span class="token operator">::</span>Context<span class="token operator">></span> context <span class="token operator">=</span><br>    v8<span class="token operator">::</span><span class="token class-name">Context</span><span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span> global<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>This example code is taken from <code>JsHttpProcessor::Initializer</code> in the <code>process.cc</code> sample.<h3 id=accessors>Accessors <a href=#accessors class=bookmark>#</a></h3><p>An accessor is a C++ callback that calculates and returns a value when an object property is accessed by a JavaScript script. Accessors are configured through an object template, using the <code>SetAccessor</code> method. This method takes the name of the property with which it is associated and two callbacks to run when a script attempts to read or write the property.<p>The complexity of an accessor depends upon the type of data you are manipulating:<ul><li><a href=#accessing-static-global-variables>Accessing static global variables</a><li><a href=#accessing-dynamic-variables>Accessing dynamic variables</a></ul><h3 id=accessing-static-global-variables>Accessing static global variables <a href=#accessing-static-global-variables class=bookmark>#</a></h3><p>Let’s say there are two C++ integer variables, <code>x</code> and <code>y</code> that are to be made available to JavaScript as global variables within a context. To do this, you need to call C++ accessor functions whenever a script reads or writes those variables. These accessor functions convert a C++ integer to a JavaScript integer using <code>Integer::New</code>, and convert a JavaScript integer to a C++ integer using <code>Int32Value</code>. An example is provided below:<pre class=language-cpp><code class=language-cpp><span class="token keyword">void</span> <span class="token function">XGetter</span><span class="token punctuation">(</span>v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>v8<span class="token operator">::</span>String<span class="token operator">></span> property<span class="token punctuation">,</span><br>              <span class="token keyword">const</span> v8<span class="token operator">::</span>PropertyCallbackInfo<span class="token operator">&lt;</span>Value<span class="token operator">></span><span class="token operator">&</span> info<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  info<span class="token punctuation">.</span><span class="token function">GetReturnValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">void</span> <span class="token function">XSetter</span><span class="token punctuation">(</span>v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>v8<span class="token operator">::</span>String<span class="token operator">></span> property<span class="token punctuation">,</span> v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>v8<span class="token operator">::</span>Value<span class="token operator">></span> value<span class="token punctuation">,</span><br>             <span class="token keyword">const</span> v8<span class="token operator">::</span>PropertyCallbackInfo<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token operator">&</span> info<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  x <span class="token operator">=</span> value<span class="token operator">-></span><span class="token function">Int32Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// YGetter/YSetter are so similar they are omitted for brevity</span><br><br>v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>v8<span class="token operator">::</span>ObjectTemplate<span class="token operator">></span> global_templ <span class="token operator">=</span> v8<span class="token operator">::</span><span class="token class-name">ObjectTemplate</span><span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>isolate<span class="token punctuation">)</span><span class="token punctuation">;</span><br>global_templ<span class="token operator">-></span><span class="token function">SetAccessor</span><span class="token punctuation">(</span>v8<span class="token operator">::</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">NewFromUtf8</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> <span class="token string">"x"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                          XGetter<span class="token punctuation">,</span> XSetter<span class="token punctuation">)</span><span class="token punctuation">;</span><br>global_templ<span class="token operator">-></span><span class="token function">SetAccessor</span><span class="token punctuation">(</span>v8<span class="token operator">::</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">NewFromUtf8</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> <span class="token string">"y"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                          YGetter<span class="token punctuation">,</span> YSetter<span class="token punctuation">)</span><span class="token punctuation">;</span><br>v8<span class="token operator">::</span>Persistent<span class="token operator">&lt;</span>v8<span class="token operator">::</span>Context<span class="token operator">></span> context <span class="token operator">=</span><br>    v8<span class="token operator">::</span>Context<span class="token operator">::</span>v8<span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span> global_templ<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Note that the object template in the code above is created at the same time as the context. The template could have been created in advance and then used for any number of contexts.<h3 id=accessing-dynamic-variables>Accessing dynamic variables <a href=#accessing-dynamic-variables class=bookmark>#</a></h3><p>In the preceding example the variables were static and global. What if the data being manipulated is dynamic, as is true of the DOM tree in a browser? Let’s imagine <code>x</code> and <code>y</code> are object fields on the C++ class <code>Point</code>:<pre class=language-cpp><code class=language-cpp><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span><br> <span class="token keyword">public</span><span class="token operator">:</span><br>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">x_</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">y_</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><br>  <span class="token keyword">int</span> x_<span class="token punctuation">,</span> y_<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>To make any number of C++ <code>point</code> instances available to JavaScript we need to create one JavaScript object for each C++ <code>point</code> and make a connection between the JavaScript object and the C++ instance. This is done with external values and internal object fields.<p>First create an object template for the <code>point</code> wrapper object:<pre class=language-cpp><code class=language-cpp>v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>v8<span class="token operator">::</span>ObjectTemplate<span class="token operator">></span> point_templ <span class="token operator">=</span> v8<span class="token operator">::</span><span class="token class-name">ObjectTemplate</span><span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>isolate<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Each JavaScript <code>point</code> object keeps a reference to the C++ object for which it is a wrapper with an internal field. These fields are so named because they cannot be accessed from within JavaScript, they can only be accessed from C++ code. An object can have any number of internal fields, the number of internal fields is set on the object template as follows:<pre class=language-cpp><code class=language-cpp>point_templ<span class="token operator">-></span><span class="token function">SetInternalFieldCount</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Here the internal field count is set to <code>1</code> which means the object has one internal field, with an index of <code>0</code>, that points to a C++ object.<p>Add the <code>x</code> and <code>y</code> accessors to the template:<pre class=language-cpp><code class=language-cpp>point_templ<span class="token operator">-></span><span class="token function">SetAccessor</span><span class="token punctuation">(</span>v8<span class="token operator">::</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">NewFromUtf8</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> <span class="token string">"x"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                         GetPointX<span class="token punctuation">,</span> SetPointX<span class="token punctuation">)</span><span class="token punctuation">;</span><br>point_templ<span class="token operator">-></span><span class="token function">SetAccessor</span><span class="token punctuation">(</span>v8<span class="token operator">::</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">NewFromUtf8</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> <span class="token string">"y"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                         GetPointY<span class="token punctuation">,</span> SetPointY<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Next, wrap a C++ point by creating a new instance of the template and then setting the internal field <code>0</code> to an external wrapper around the point <code>p</code>.<pre class=language-cpp><code class=language-cpp>Point<span class="token operator">*</span> p <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span><br>v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>v8<span class="token operator">::</span>Object<span class="token operator">></span> obj <span class="token operator">=</span> point_templ<span class="token operator">-></span><span class="token function">NewInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>obj<span class="token operator">-></span><span class="token function">SetInternalField</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> v8<span class="token operator">::</span><span class="token class-name">External</span><span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The external object is simply a wrapper around a <code>void*</code>. External objects can only be used to store reference values in internal fields. JavaScript objects can not have references to C++ objects directly so the external value is used as a "bridge" to go from JavaScript into C++. In that sense external values are the opposite of handles since handles lets C++ make references to JavaScript objects.<p>Here’s the definition of the <code>get</code> and <code>set</code> accessors for <code>x</code>, the <code>y</code> accessor definitions are identical except <code>y</code> replaces <code>x</code>:<pre class=language-cpp><code class=language-cpp><span class="token keyword">void</span> <span class="token function">GetPointX</span><span class="token punctuation">(</span>Local<span class="token operator">&lt;</span>String<span class="token operator">></span> property<span class="token punctuation">,</span><br>               <span class="token keyword">const</span> PropertyCallbackInfo<span class="token operator">&lt;</span>Value<span class="token operator">></span><span class="token operator">&</span> info<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>v8<span class="token operator">::</span>Object<span class="token operator">></span> self <span class="token operator">=</span> info<span class="token punctuation">.</span><span class="token function">Holder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>v8<span class="token operator">::</span>External<span class="token operator">></span> wrap <span class="token operator">=</span><br>      v8<span class="token operator">::</span><span class="token class-name">Local</span><span class="token operator">&lt;</span>v8<span class="token operator">::</span>External<span class="token operator">></span><span class="token operator">::</span><span class="token function">Cast</span><span class="token punctuation">(</span>self<span class="token operator">-></span><span class="token function">GetInternalField</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">void</span><span class="token operator">*</span> ptr <span class="token operator">=</span> wrap<span class="token operator">-></span><span class="token function">Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span>Point<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>ptr<span class="token punctuation">)</span><span class="token operator">-></span>x_<span class="token punctuation">;</span><br>  info<span class="token punctuation">.</span><span class="token function">GetReturnValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">void</span> <span class="token function">SetPointX</span><span class="token punctuation">(</span>v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>v8<span class="token operator">::</span>String<span class="token operator">></span> property<span class="token punctuation">,</span> v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>v8<span class="token operator">::</span>Value<span class="token operator">></span> value<span class="token punctuation">,</span><br>               <span class="token keyword">const</span> v8<span class="token operator">::</span>PropertyCallbackInfo<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token operator">&</span> info<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>v8<span class="token operator">::</span>Object<span class="token operator">></span> self <span class="token operator">=</span> info<span class="token punctuation">.</span><span class="token function">Holder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>v8<span class="token operator">::</span>External<span class="token operator">></span> wrap <span class="token operator">=</span><br>      v8<span class="token operator">::</span><span class="token class-name">Local</span><span class="token operator">&lt;</span>v8<span class="token operator">::</span>External<span class="token operator">></span><span class="token operator">::</span><span class="token function">Cast</span><span class="token punctuation">(</span>self<span class="token operator">-></span><span class="token function">GetInternalField</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">void</span><span class="token operator">*</span> ptr <span class="token operator">=</span> wrap<span class="token operator">-></span><span class="token function">Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">static_cast</span><span class="token operator">&lt;</span>Point<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>ptr<span class="token punctuation">)</span><span class="token operator">-></span>x_ <span class="token operator">=</span> value<span class="token operator">-></span><span class="token function">Int32Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Accessors extract the reference to the <code>point</code> object that was wrapped by the JavaScript object and then read and writes the associated field. This way these generic accessors can be used on any number of wrapped point objects.<h3 id=interceptors>Interceptors <a href=#interceptors class=bookmark>#</a></h3><p>You can also specify a callback for whenever a script accesses any object property. These are called interceptors. For efficiency, there are two types of interceptors:<ul><li><em>named property interceptors</em> - called when accessing properties with string names.<br>An example of this, in a browser environment, is <code>document.theFormName.elementName</code>.<li><em>indexed property interceptors</em> - called when accessing indexed properties. An example of this, in a browser environment, is <code>document.forms.elements[0]</code>.</ul><p>The sample <code>process.cc</code>, provided with the V8 source code, includes an example of using interceptors. In the following code snippet <code>SetNamedPropertyHandler</code> specifies the <code>MapGet</code> and <code>MapSet</code> interceptors:<pre class=language-cpp><code class=language-cpp>v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>v8<span class="token operator">::</span>ObjectTemplate<span class="token operator">></span> result <span class="token operator">=</span> v8<span class="token operator">::</span><span class="token class-name">ObjectTemplate</span><span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>isolate<span class="token punctuation">)</span><span class="token punctuation">;</span><br>result<span class="token operator">-></span><span class="token function">SetNamedPropertyHandler</span><span class="token punctuation">(</span>MapGet<span class="token punctuation">,</span> MapSet<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The <code>MapGet</code> interceptor is provided below:<pre class=language-cpp><code class=language-cpp><span class="token keyword">void</span> <span class="token class-name">JsHttpRequestProcessor</span><span class="token operator">::</span><span class="token function">MapGet</span><span class="token punctuation">(</span>v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>v8<span class="token operator">::</span>String<span class="token operator">></span> name<span class="token punctuation">,</span><br>                                    <span class="token keyword">const</span> v8<span class="token operator">::</span>PropertyCallbackInfo<span class="token operator">&lt;</span>Value<span class="token operator">></span><span class="token operator">&</span> info<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Fetch the map wrapped by this object.</span><br>  map<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> string<span class="token operator">></span> <span class="token operator">*</span>obj <span class="token operator">=</span> <span class="token function">UnwrapMap</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span><span class="token function">Holder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Convert the JavaScript string to a std::string.</span><br>  string key <span class="token operator">=</span> <span class="token function">ObjectToString</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Look up the value if it exists using the standard STL idiom.</span><br>  map<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> string<span class="token operator">></span><span class="token operator">::</span>iterator iter <span class="token operator">=</span> obj<span class="token operator">-></span><span class="token function">find</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// If the key is not present return an empty handle as signal.</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>iter <span class="token operator">==</span> obj<span class="token operator">-></span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Otherwise fetch the value and wrap it in a JavaScript string.</span><br>  <span class="token keyword">const</span> string <span class="token operator">&</span>value <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>iter<span class="token punctuation">)</span><span class="token punctuation">.</span>second<span class="token punctuation">;</span><br>  info<span class="token punctuation">.</span><span class="token function">GetReturnValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>v8<span class="token operator">::</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">NewFromUtf8</span><span class="token punctuation">(</span><br>      value<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v8<span class="token operator">::</span>String<span class="token operator">::</span>kNormalString<span class="token punctuation">,</span> value<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>As with accessors, the specified callbacks are invoked whenever a property is accessed. The difference between accessors and interceptors is that interceptors handle all properties, while accessors are associated with one specific property.<h3 id=security-model>Security model <a href=#security-model class=bookmark>#</a></h3><p>The “same-origin policy” (first introduced with Netscape Navigator 2.0) prevents a document or script loaded from one “origin” from getting or setting properties of a document from a different “origin”. The term origin is defined here as a combination of domain name (e.g. <code>www.example.com</code>), protocol (e.g. <code>https</code>) and port. For example, <code>www.example.com:81</code> is not the same origin as <code>www.example.com</code>. All three must match for two web pages to be considered to have the same origin. Without this protection, a malicious web page could compromise the integrity of another web page.<p>In V8 an “origin” is defined as a context. Access to any context other than the one from which you are calling is not allowed by default. To access a context other than the one from which you are calling, you need to use security tokens or security callbacks. A security token can be any value but is typically a symbol, a canonical string that does not exist anywhere else. You can optionally specify a security token with <code>SetSecurityToken</code> when you set up a context. If you do not specify a security token V8 will automatically generate one for the context you are creating.<p>When an attempt is made to access a global variable the V8 security system first checks the security token of the global object being accessed against the security token of the code attempting to access the global object. If the tokens match access is granted. If the tokens do not match V8 performs a callback to check if access should be allowed. You can specify whether access to an object should be allowed by setting the security callback on the object, using the <code>SetAccessCheckCallbacks</code> method on object templates. The V8 security system can then fetch the security callback of the object being accessed and call it to ask if another context is allowed to access it. This callback is given the object being accessed, the name of the property being accessed, the type of access (read, write, or delete for example) and returns whether or not to allow access.<p>This mechanism is implemented in Google Chrome so that if security tokens do not match, a special callback is used to allow access only to the following: <code>window.focus()</code>, <code>window.blur()</code>, <code>window.close()</code>, <code>window.location</code>, <code>window.open()</code>, <code>history.forward()</code>, <code>history.back()</code>, and <code>history.go()</code>.<h3 id=exceptions>Exceptions <a href=#exceptions class=bookmark>#</a></h3><p>V8 throws an exception if an error occurs — for example, when a script or function attempts to read a property that does not exist, or if a function is called that is not a function.<p>V8 returns an empty handle if an operation did not succeed. It is therefore important that your code checks a return value is not an empty handle before continuing execution. Check for an empty handle with the <code>Local</code> class’s public member function <code>IsEmpty()</code>.<p>You can catch exceptions with <code>TryCatch</code>, for example:<pre class=language-cpp><code class=language-cpp>v8<span class="token operator">::</span>TryCatch <span class="token function">trycatch</span><span class="token punctuation">(</span>isolate<span class="token punctuation">)</span><span class="token punctuation">;</span><br>v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>v8<span class="token operator">::</span>Value<span class="token operator">></span> v <span class="token operator">=</span> script<span class="token operator">-></span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">IsEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>v8<span class="token operator">::</span>Value<span class="token operator">></span> exception <span class="token operator">=</span> trycatch<span class="token punctuation">.</span><span class="token function">Exception</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  v8<span class="token operator">::</span>String<span class="token operator">::</span>Utf8Value <span class="token function">exception_str</span><span class="token punctuation">(</span>exception<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Exception: %s\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>exception_str<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// ...</span><br><span class="token punctuation">}</span></code></pre><p>If the value returned is an empty handle, and you do not have a <code>TryCatch</code> in place, your code must bail out. If you do have a <code>TryCatch</code> the exception is caught and your code is allowed to continue processing.<h3 id=inheritance>Inheritance <a href=#inheritance class=bookmark>#</a></h3><p>JavaScript is a <em>class-free</em>, object-oriented language, and as such, it uses prototypal inheritance instead of classical inheritance. This can be puzzling to programmers trained in conventional object-oriented languages like C++ and Java.<p>Class-based object-oriented languages, such as Java and C++, are founded on the concept of two distinct entities: classes and instances. JavaScript is a prototype-based language and so does not make this distinction: it simply has objects. JavaScript does not natively support the declaration of class hierarchies; however, JavaScript’s prototype mechanism simplifies the process of adding custom properties and methods to all instances of an object. In JavaScript, you can add custom properties to objects. For example:<pre class=language-js><code class=language-js><span class="token comment">// Create an object named `bicycle`.</span><br><span class="token keyword">function</span> <span class="token function">bicycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br><span class="token comment">// Create an instance of `bicycle` called `roadbike`.</span><br><span class="token keyword">var</span> roadbike <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">bicycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// Define a custom property, `wheels`, on `roadbike`.</span><br>roadbike<span class="token punctuation">.</span>wheels <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></code></pre><p>A custom property added this way only exists for that instance of the object. If we create another instance of <code>bicycle()</code>, called <code>mountainbike</code> for example, <code>mountainbike.wheels</code> would return <code>undefined</code> unless the <code>wheels</code> property is explicitly added.<p>Sometimes this is exactly what is required, at other times it would be helpful to add the custom property to all instances of an object - all bicycles have wheels after all. This is where the prototype object of JavaScript is very useful. To use the prototype object, reference the keyword <code>prototype</code> on the object before adding the custom property to it as follows:<pre class=language-js><code class=language-js><span class="token comment">// First, create the “bicycle” object</span><br><span class="token keyword">function</span> <span class="token function">bicycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br><span class="token comment">// Assign the wheels property to the object’s prototype</span><br>bicycle<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>wheels <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></code></pre><p>All instances of <code>bicycle()</code> will now have the <code>wheels</code> property prebuilt into them.<p>The same approach is used in V8 with templates. Each <code>FunctionTemplate</code> has a <code>PrototypeTemplate</code> method which gives a template for the function’s prototype. You can set properties, and associate C++ functions with those properties, on a <code>PrototypeTemplate</code> which will then be present on all instances of the corresponding <code>FunctionTemplate</code>. For example:<pre class=language-cpp><code class=language-cpp>v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>v8<span class="token operator">::</span>FunctionTemplate<span class="token operator">></span> biketemplate <span class="token operator">=</span> v8<span class="token operator">::</span><span class="token class-name">FunctionTemplate</span><span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>isolate<span class="token punctuation">)</span><span class="token punctuation">;</span><br>biketemplate<span class="token operator">-></span><span class="token function">PrototypeTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><br>    v8<span class="token operator">::</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">NewFromUtf8</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> <span class="token string">"wheels"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    v8<span class="token operator">::</span><span class="token class-name">FunctionTemplate</span><span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> MyWheelsMethodCallback<span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">GetFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>This causes all instances of <code>biketemplate</code> to have a <code>wheels</code> method in their prototype chain which, when called, causes the C++ function <code>MyWheelsMethodCallback</code> to be called.<p>V8’s <code>FunctionTemplate</code> class provides the public member function <code>Inherit()</code> which you can call when you want a function template to inherit from another function template, as follows:<pre class=language-cpp><code class=language-cpp><span class="token keyword">void</span> <span class="token function">Inherit</span><span class="token punctuation">(</span>v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>v8<span class="token operator">::</span>FunctionTemplate<span class="token operator">></span> parent<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></main><footer id=footer><div><nav><a href=https://v8.dev/docs/embed>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/docs/embed.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>