<!doctype html><html lang=zh-CN><meta charset=utf-8><title>V8’s public API · V8</title><meta content="width=device-width,initial-scale=1" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=' js'</script><meta content="This document discusses the stability of V8’s public API, and how developers can make changes to it." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li><a href=/blog/ >博客</a><li class=active><a href=/docs/ >文档</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><h1>V8’s public API</h1><p>This document discusses the stability of V8’s public API, and how developers can make changes to it.<h2 id=api-stability>API stability <a href=#api-stability class=bookmark>#</a></h2><p>If V8 in a Chromium canary turns out to be crashy, it gets rolled back to the V8 version of the previous canary. It is therefore important to keep V8’s API compatible from one canary version to the next.<p>We continuously run a <a href=https://ci.chromium.org/p/v8/builders/luci.v8.ci/Linux%20V8%20API%20Stability>bot</a> that signals API stability violations. It compiles Chromium’s HEAD with V8’s <a href=https://chromium.googlesource.com/v8/v8/+/refs/heads/canary>current canary version</a>.<p>Failures of this bot are currently only FYI and no action is required. The blame list can be used to easily identify dependent CLs in case of a rollback.<p>If you break this bot, be reminded to increase the window between a V8 change and a dependent Chromium change next time.<h2 id=how-to-change-v8%E2%80%99s-public-api>How to change V8’s public API <a href=#how-to-change-v8%E2%80%99s-public-api class=bookmark>#</a></h2><p>V8 is used by many different embedders: Chrome, Node.js, gjstest, etc. When changing V8’s public API (basically the files under the <code>include/</code> directory) we need to ensure that the embedders can smoothly update to the new V8 version. In particular, we cannot assume that an embedder updates to the new V8 version and adjusts their code to the new API in one atomic change.<p>The embedder should be able to adjust their code to the new API while still using the previous version of V8. All instructions below follow from this rule.<ul><li><p>Adding new types, constants, and functions is safe with one caveat: do not add a new pure virtual function to an existing class. New virtual functions should have default implementation.<li><p>Adding a new parameter to a function is safe if the parameter has the default value.<li><p>Removing or renaming types, constants, functions is unsafe. Use the <a href="https://cs.chromium.org/chromium/src/v8/include/v8config.h?l=395&rcl=0425b20ad9a8ba38c2e0dd16e8814abb722bfdde"><code>V8_DEPRECATED</code></a> and <a href="https://cs.chromium.org/chromium/src/v8/include/v8config.h?l=403&rcl=0425b20ad9a8ba38c2e0dd16e8814abb722bfdde"><code>V8_DEPRECATE_SOON</code></a> macros, which causes compile-time warnings when the deprecated methods are called by the embedder. For example, let’s say we want to rename function <code>foo</code> to function <code>bar</code>. Then we need to do the following:<ul><li>Add the new function <code>bar</code> near the existing function <code>foo</code>.<li>Wait until the CL rolls in Chrome. Adjust Chrome to use <code>bar</code>.<li>Annotate <code>foo</code> with <code>V8_DEPRECATED("Use bar instead") void foo();</code><li>In the same CL adjust the tests that use <code>foo</code> to use <code>bar</code>.<li>Write in CL motivation for the change and high-level update instructions.<li>Wait until the next V8 branch.<li>Remove function <code>foo</code>.</ul><p><code>V8_DEPRECATE_SOON</code> is a softer version of <code>V8_DEPRECATED</code>. Chrome will not break with it, so step b is not need. <code>V8_DEPRECATE_SOON</code> is not sufficient for removing the function.<p>You still need to annotate with <code>V8_DEPRECATED</code> and wait for the next branch before removing the function.<p><code>V8_DEPRECATED</code> can be tested using the <code>v8_deprecation_warnings</code> GN flag.<br><code>V8_DEPRECATE_SOON</code> can be tested using <code>v8_imminent_deprecation_warnings</code>.<li><p>Changing function signatures is unsafe. Use the <code>V8_DEPRECATED</code> and <code>V8_DEPRECATE_SOON</code> macros as described above.</ul><p>We maintain a <a href=https://docs.google.com/document/d/1g8JFi8T_oAE_7uAri7Njtig7fKaPDfotU6huOa1alds/edit>document mentioning important API changes</a> for each V8 version.<p>There is also a regularly updated <a href=https://v8.dev/api>doxygen api documentation</a>.</main><footer id=footer><div><nav><a href=https://v8.dev/docs/api>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/docs/api.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>