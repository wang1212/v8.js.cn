<!doctype html><html lang=zh-CN><meta charset=utf-8><title>Testing · V8</title><meta content="width=device-width,initial-scale=1" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=' js'</script><meta content="This document explains the testing framework that is part of the V8 repository." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li><a href=/blog/ >博客</a><li class=active><a href=/docs/ >文档</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><h1>Testing</h1><p>V8 includes a test framework that allows you to test the engine. The framework lets you run both our own test suites that are included with the source code and others, such as <a href=https://github.com/tc39/test262>the Test262 test suite</a>.<h2 id=running-the-v8-tests>Running the V8 tests <a href=#running-the-v8-tests class=bookmark>#</a></h2><p><a href=/docs/build-gn#gm>Using <code>gm</code></a>, you can simply append <code>.check</code> to any build target to have tests run for it, e.g.<pre class=language-bash><code class=language-bash>gm x64.release.check<br>gm x64.optdebug.check  <span class="token comment"># recommended: reasonably fast, with DCHECKs.</span><br>gm ia32.check<br>gm release.check<br>gm check  <span class="token comment"># builds and tests all default platforms</span></code></pre><p><code>gm</code> automatically builds any required targets before running the tests. You can also limit the tests to be run:<pre class=language-bash><code class=language-bash>gm x64.release test262<br>gm x64.debug mjsunit/regress/regress-123</code></pre><p>If you have already built V8, you can run the tests manually:<pre class=language-bash><code class=language-bash>tools/run-tests.py --outdir<span class="token operator">=</span>out/ia32.release</code></pre><p>Again, you can specify which tests to run:<pre class=language-bash><code class=language-bash>tools/run-tests.py --outdir<span class="token operator">=</span>ia32.release cctest/test-heap/SymbolTable/* mjsunit/delete-in-eval</code></pre><p>Run the script with <code>--help</code> to find out about its other options.<h2 id=running-more-tests>Running more tests <a href=#running-more-tests class=bookmark>#</a></h2><p>The default set of tests to be run does not include all available tests. You can specify additional test suites on the command line of either <code>gm</code> or <code>run-tests.py</code>:<ul><li><code>benchmarks</code> (just for correctness; does not produce benchmark results!)<li><code>mozilla</code><li><code>test262</code><li><code>webkit</code></ul><h2 id=running-microbenchmarks>Running microbenchmarks <a href=#running-microbenchmarks class=bookmark>#</a></h2><p>Under <code>test/js-perf-test</code> we have microbenchmarks to track feature performance. There is a special runner for these: <code>tools/run_perf.py</code>. Run them like:<pre class=language-bash><code class=language-bash>tools/run_perf.py --arch x64 --binary-override-path out/x64.release/d8 test/js-perf-test/JSTests.json</code></pre><p>If you don’t want to run all the <code>JSTests</code>, you can provide a <code>filter</code> argument:<pre class=language-bash><code class=language-bash>tools/run_perf.py --arch x64 --binary-override-path out/x64.release/d8 --filter JSTests/TypedArrays test/js-perf-test/JSTests.json</code></pre><h2 id=updating-the-bytecode-expectations-(rebaselining)>Updating the bytecode expectations (rebaselining) <a href=#updating-the-bytecode-expectations-(rebaselining) class=bookmark>#</a></h2><p>Sometimes the bytecode expectations may change resulting in <code>cctest</code> failures. To update the golden files, build <code>test/cctest/generate-bytecode-expectations</code> by running:<pre class=language-bash><code class=language-bash>gm x64.release generate-bytecode-expectations</code></pre><p>…and then updating the default set of inputs by passing the <code>--rebaseline</code> flag to the generated binary:<pre class=language-bash><code class=language-bash>out/x64.release/generate-bytecode-expectations --rebaseline</code></pre><p>The updated goldens are now available in <code>test/cctest/interpreter/bytecode_expectations/</code>.<h2 id=adding-a-new-bytecode-expectations-test>Adding a new bytecode expectations test <a href=#adding-a-new-bytecode-expectations-test class=bookmark>#</a></h2><ol><li><p>Add a new test case to <code>cctest/interpreter/test-bytecode-generator.cc</code> and specify a golden file with the same test name.<li><p>Build <code>generate-bytecode-expectations</code>:<pre class=language-bash><code class=language-bash>gm x64.release generate-bytecode-expectations</code></pre><li><p>Run<pre class=language-bash><code class=language-bash>out/x64.release/generate-bytecode-expectations --raw-js testcase.js --output<span class="token operator">=</span>test/cctest/interpreter/bytecode-expectations/testname.golden</code></pre><p>where <code>testcase.js</code> contains the JavaScript test case that was added to <code>test-bytecode-generator.cc</code> and <code>testname</code> is the name of the test defined in <code>test-bytecode-generator.cc</code>.</ol></main><footer id=footer><div><nav><a href=https://v8.dev/docs/test>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/docs/test.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>