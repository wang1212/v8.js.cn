<!doctype html><html lang=zh-CN><meta charset=utf-8><title>Checklist for staging and shipping of WebAssembly features · V8</title><meta content="width=device-width,initial-scale=1" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=' js'</script><meta content="This document provides checklists of engineering requirements on when to stage and ship a WebAssembly feature in V8." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li><a href=/blog/ >博客</a><li class=active><a href=/docs/ >文档</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><h1>Checklist for staging and shipping of WebAssembly features</h1><p>This document provides checklists of engineering requirements for staging and shipping WebAssembly features in V8. These checklists are meant as a guideline and may not be applicable to all features. The actual launch process is described in the <a href=https://v8.dev/docs/feature-launch-process>V8 Launch process</a>.<h1 id=staging>Staging <a href=#staging class=bookmark>#</a></h1><h2 id=when-to-stage-a-webassembly-feature>When to stage a WebAssembly feature <a href=#when-to-stage-a-webassembly-feature class=bookmark>#</a></h2><p>The <a href=https://docs.google.com/document/d/1ZgyNx7iLtRByBtbYi1GssWGefXXciLeADZBR_FxG-hE>staging</a> of a WebAssembly feature defines the end of its implementation phase. The implementation phase is finished when the following checklist is done:<ul><li>The implementation in V8 is complete. This includes:<ul><li>Implementation in TurboFan (if applicable)<li>Implementation in Liftoff (if applicable)<li>Implementation in the interpreter (if applicable)</ul><li>Tests in V8 are available<li>Spec tests are rolled into V8 by running <a href=https://cs.chromium.org/chromium/src/v8/tools/wasm/update-wasm-spec-tests.sh><code>tools/wasm/update-wasm-spec-tests.sh</code></a><li>All existing proposal spec tests pass. Missing spec tests are unfortunate but should not block staging.</ul><p>Note that the stage of the feature proposal in the standardization process does not matter for staging the feature in V8. The proposal should, however, be mostly stable.<h2 id=how-to-stage-a-webassembly-feature>How to stage a WebAssembly feature <a href=#how-to-stage-a-webassembly-feature class=bookmark>#</a></h2><ul><li>In <a href=https://cs.chromium.org/chromium/src/v8/src/wasm/wasm-feature-flags.h><code>src/wasm/wasm-feature-flags.h</code></a>, move the feature flag from the <code>FOREACH_WASM_EXPERIMENTAL_FEATURE_FLAG</code> macro list to the <code>FOREACH_WASM_STAGING_FEATURE_FLAG</code> macro list.<li>In <a href=https://cs.chromium.org/chromium/src/v8/tools/wasm/update-wasm-spec-tests.sh><code>tools/wasm/update-wasm-spec-tests.sh</code></a>, add the proposal repository name to the <code>repos</code> list of repositories.<li>Run <a href=https://cs.chromium.org/chromium/src/v8/tools/wasm/update-wasm-spec-tests.sh><code>tools/wasm/update-wasm-spec-tests.sh</code></a> to create and upload the spec tests of the new proposal.<li>In <a href=https://cs.chromium.org/chromium/src/v8/test/wasm-spec-tests/testcfg.py><code>test/wasm-spec-tests/testcfg.py</code></a>, add the proposal repository name and the feature flag to the <code>proposal_flags</code> list.<li>In <a href=https://cs.chromium.org/chromium/src/v8/test/wasm-js/testcfg.py><code>test/wasm-js/testcfg.py</code></a>, add the proposal repository name and the feature flag to the <code>proposal_flags</code> list.</ul><p>See the <a href=https://crrev.com/c/1771791>staging of type reflection</a> as a reference.<h1 id=shipping>Shipping <a href=#shipping class=bookmark>#</a></h1><h2 id=when-is-a-webassembly-feature-ready-to-be-shipped>When is a WebAssembly feature ready to be shipped <a href=#when-is-a-webassembly-feature-ready-to-be-shipped class=bookmark>#</a></h2><ul><li>The <a href=https://v8.dev/docs/feature-launch-process>V8 Launch process</a> is satisfied.<li>The implementation is covered by a fuzzer (if applicable).<li>The feature has been staged for several weeks to get fuzzer coverage.<li>The feature proposal is <a href=https://github.com/WebAssembly/proposals>stage 4</a>.<li>All <a href=https://github.com/WebAssembly/spec/tree/master/test>spec tests</a> pass.<li>The <a href=https://docs.google.com/document/d/1WbL-fGuLbbNr5-n_nRGo_ILqZFnh5ZjRSUcDTT3yI8s/preview>Chromium DevTools checklist for new WebAssembly features</a> is satisfied.</ul><h2 id=how-to-ship-a-webassembly-feature>How to ship a WebAssembly Feature <a href=#how-to-ship-a-webassembly-feature class=bookmark>#</a></h2><ul><li>In <a href=https://source.chromium.org/chromium/chromium/src/+/master:v8/src/wasm/wasm-feature-flags.h><code>src/wasm/wasm-feature-flags.h</code></a>, move the feature flag from the <code>FOREACH_WASM_STAGING_FEATURE_FLAG</code> macro list to the <code>FOREACH_WASM_SHIPPED_FEATURE_FLAG</code> macro list.<ul><li>Ensure to add a blink CQ bot on the CL to check for <a href=https://v8.dev/docs/blink-layout-tests>blink web test</a> failures caused by enabling the feature (add this line to the footer of the CL description: <code>Cq-Include-Trybots: luci.v8.try:v8_linux_blink_rel</code>).</ul><li>Additionally, enable the feature by default by changing the third parameter in <code>FOREACH_WASM_SHIPPED_FEATURE_FLAG</code> to <code>true</code>.<li>Set a reminder to remove the feature flag after two milestones.</ul></main><footer id=footer><div><nav><a href=https://v8.dev/docs/wasm-shipping-checklist>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/docs/wasm-shipping-checklist.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>