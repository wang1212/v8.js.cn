<!doctype html><html lang=zh-CN><meta charset=utf-8><title>Tracing V8 · V8</title><meta content="width=device-width,initial-scale=1" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=' js'</script><meta content="This document explains how to make use of V8’s built-in tracing support." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li><a href=/blog/ >博客</a><li class=active><a href=/docs/ >文档</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><h1>Tracing V8</h1><p>V8 provides support for tracing. It <a href=/docs/rcs>works automatically when V8 is embedded in Chrome through the Chrome tracing system</a>. But you can also enable it in any standalone V8 or within an embedder that uses the Default Platform. More details about the trace-viewer can be found <a href=https://github.com/catapult-project/catapult/blob/master/tracing/README.md>here</a>.<h2 id=tracing-in-d8>Tracing in <code>d8</code> <a href=#tracing-in-d8 class=bookmark>#</a></h2><p>To start tracing, use the <code>--enable-tracing</code> option. V8 generates a <code>v8_trace.json</code> that you can open in Chrome. To open it in Chrome, go to <code>chrome://tracing</code>, click on “Load”, and then load the <code>v8-trace.json</code> file.<p>Each trace event is a associated with a set of categories, you can enable/disable the recording of trace events based on their categories. With the above flag only, we only enable the default categories (a set of categories that has a low overhead). To enable more categories and have a more fine control of the different parameters, you need to pass a config file.<p>Here’s an example of a config file <code>traceconfig.json</code>:<pre class=language-json><code class=language-json><span class="token punctuation">{</span><br>  <span class="token property">"record_mode"</span><span class="token operator">:</span> <span class="token string">"record-continuously"</span><span class="token punctuation">,</span><br>  <span class="token property">"included_categories"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"v8"</span><span class="token punctuation">,</span> <span class="token string">"disabled-by-default-v8.runtime_stats"</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><p>An example of calling <code>d8</code> with tracing and a traceconfig file:<pre class=language-bash><code class=language-bash>d8 --enable-tracing --trace-config<span class="token operator">=</span>traceconfig.json</code></pre><p>The trace config format is compatible with the one of Chrome Tracing, however, we don’t support regular expression in included categories list, and V8 doesn’t need excluded categories list, thus the trace config file for V8 can be reused in Chrome tracing, but you can’t reuse Chrome trace config file in V8 tracing if the trace config file contains regular expression, besides, V8 ignores the excluded categories list.<h2 id=enabling-runtime-call-statistics-in-tracing>Enabling Runtime Call Statistics in tracing <a href=#enabling-runtime-call-statistics-in-tracing class=bookmark>#</a></h2><p>To get Runtime Call Statistics (<abbr>RCS</abbr>), please record the trace with the following two categories enabled: <code>v8</code> and <code>disabled-by-default-v8.runtime_stats</code>. Each top-level V8 trace event contains the runtime statistics for the period of that event. By selecting any of those events in <code>trace-viewer</code>, the runtime stats table are displayed in the lower panel. Selecting multiple events create a merged view.<figure><img alt="" height=1068 loading=lazy src=/_img/docs/trace/runtime-stats.png width=2048></figure><h2 id=enabling-gc-object-statistics-in-tracing>Enabling GC Object Statistics in tracing <a href=#enabling-gc-object-statistics-in-tracing class=bookmark>#</a></h2><p>To get the GC Object Statistics in tracing, you need to collect a trace with <code>disabled-by-default-v8.gc_stats</code> category enabled also you need to use the following <code>--js-flags</code>:<pre><code>--track_gc_object_stats --noincremental-marking
</code></pre><p>Once you load the trace in <code>trace-viewer</code>, search for slices named: <code>V8.GC_Object_Stats</code>. The statistics appear in the lower panel. Selecting multiple slices creates a merged view.<figure><img alt="" height=1162 loading=lazy src=/_img/docs/trace/gc-stats.png width=2586></figure></main><footer id=footer><div><nav><a href=https://v8.dev/docs/trace>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/docs/trace.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>