<!doctype html><html lang=zh-CN><meta charset=utf-8><title>Intl.RelativeTimeFormat · V8</title><meta content="width=device-width,initial-scale=1" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/_css/feature-support.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=' js'</script><meta content="Intl.RelativeTimeFormat enables localized formatting of relative times without sacrificing performance." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li><a href=/blog/ >博客</a><li><a href=/docs/ >文档</a><li class=current><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline><code>Intl.RelativeTimeFormat</code></h1><p class=meta>发布时间 <time datetime="2018-10-22 00:00:00" itemprop=datePublished>2018-10-22</time> · 标签： <a href=/features/tags/intl class=tag>Intl</a></header><div itemprop=articleBody><p>现代 Web 应用程序通常使用“昨天”，“42秒前”或“3个月”之类的短语，而不是完整的日期和时间戳。这种相对时间格式已经变得非常普遍，以至于几个流行的库都实现了本地化格式化的函数。（例如 <a href=https://momentjs.com/ >Moment.js</a>, <a href=https://github.com/globalizejs/globalize>Globalize</a>, <a href=https://date-fns.org/docs/ >date-fns</a>）<p>实现本地化相对时间格式化的一个问题是，您需要为每种语言提供习惯词或短语列表（例如“昨天”或“上一季度”）。<a href=http://cldr.unicode.org/ >Unicode CLDR</a> 提供了此数据，但要在 JavaScript 中使用它，必须将其嵌入到库代码中一起提供。遗憾的是，这无疑会增加这些库的包大小，这会影响到脚本的加载时间、解析/编译成本和内存消耗。<p>全新的 <code>Intl.RelativeTimeFormat</code> API 将此负担转移到了 JavaScript 引擎，JavaScript 引擎可以提供语言环境数据并使其直接供 JavaScript 开发人员使用。 <code>Intl.RelativeTimeFormat</code> 在不牺牲性能的情况下实现相对时间的本地化格式化。<h2 id=usage-examples>用法与示例 <a href=#usage-examples class=bookmark>#</a></h2><p>以下示例展示了如何使用英语创建相对时间格式化程序。<pre class=language-js><code class=language-js><span class="token keyword">const</span> rtf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intl<span class="token punctuation">.</span>RelativeTimeFormat</span><span class="token punctuation">(</span><span class="token string">'en'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">3.14</span><span class="token punctuation">,</span> <span class="token string">'second'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → 'in 3.14 seconds'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token string">'minute'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '15 minutes ago'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'hour'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → 'in 8 hours'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '2 days ago'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'week'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → 'in 3 weeks'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'month'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '5 months ago'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'quarter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → 'in 2 quarters'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token string">'year'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '42 years ago'</span></code></pre><p>需要注意的是传递给 Intl.RelativeTimeFormat 构造函数的参数必须是<a href=https://tools.ietf.org/html/rfc5646>一个 BCP 47 语言标记</a>，或者是<a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl#Locale_identification_and_negotiation>一个包括多个语言标记的数组</a>。<p>以下是使用其他语言（汉语简体中文）的示例：（译注：原文是西班牙语）<pre class=language-js><code class=language-js><span class="token keyword">const</span> rtf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intl<span class="token punctuation">.</span>RelativeTimeFormat</span><span class="token punctuation">(</span><span class="token string">'zh'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 或 'zh-Hans-CN'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">3.14</span><span class="token punctuation">,</span> <span class="token string">'second'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '3.14秒钟后'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token string">'minute'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '15分钟前'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'hour'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '8小时后'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '2天前'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'week'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '3周后'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'month'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '5个月前'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'quarter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '2个季度后'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token string">'year'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '42年前'</span></code></pre><p>此外，<code>Intl.RelativeTimeFormat</code> 构造函数还接受一个可选 <code>options</code> 参数，该参数可以对输出进行细粒度控制。为了说明灵活性，让我们根据默认设置查看更多输出：<pre class=language-js><code class=language-js><span class="token comment">// 创建一个简体中文相对时间格式化示例，使用默认设置。</span><br><span class="token comment">// 在这个例子中，我们将默认参数显式的传进去</span><br><span class="token keyword">const</span> rtf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intl<span class="token punctuation">.</span>RelativeTimeFormat</span><span class="token punctuation">(</span><span class="token string">'zh'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br> localeMatcher<span class="token operator">:</span> <span class="token string">'best fit'</span><span class="token punctuation">,</span> <span class="token comment">// 其他值: 'lookup'</span><br> style<span class="token operator">:</span> <span class="token string">'long'</span><span class="token punctuation">,</span> <span class="token comment">// 其他值: 'short' 或 'narrow'</span><br> numeric<span class="token operator">:</span> <span class="token string">'always'</span><span class="token punctuation">,</span> <span class="token comment">// 其他值: 'auto'</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '1天前'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '0天后'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '1天后'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'week'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '1周前'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'week'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '0周后'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'week'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '1周后'</span></code></pre><p>您可能已经注意到上面的格式化程序生成了字符串 <code>'1天前'</code> 而不是 <code>'昨天'</code>，还有显得比较弱智的 <code>'0周后'</code> 而不是 <code>'本周'</code>。发生这种情况是因为默认情况下，格式化程序使用数值进行输出。<p>要更改此行为，请将 <code>numeric</code> 选项设置为 <code>'auto'</code>（默认值是 <code>'always'</code>）：<pre class=language-js><code class=language-js><span class="token comment">// Create a relative time formatter for the English language that does</span><br><span class="token comment">// not always have to use numeric value in the output.</span><br><span class="token keyword">const</span> rtf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intl<span class="token punctuation">.</span>RelativeTimeFormat</span><span class="token punctuation">(</span><span class="token string">'zh'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> numeric<span class="token operator">:</span> <span class="token string">'auto'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '昨天'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '前天'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '今天'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '明天'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '后天'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'week'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '上周'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'week'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '本周'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'week'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '下周'</span></code></pre><p>与其他 <code>Intl</code> 类一样，<code>Intl.RelativeTimeFormat</code> 除了 <code>format</code> 方法之外，还有一个 <code>formatToParts</code> 方法。虽然 <code>format</code> 涵盖了最常见的用例，但如果您需要访问生成的输出的各个部分，<code>formatToParts</code> 会很有帮助：<pre class=language-js><code class=language-js><span class="token comment">// Create a relative time formatter for the English language that does</span><br><span class="token comment">// not always have to use numeric value in the output.</span><br><span class="token keyword">const</span> rtf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intl<span class="token punctuation">.</span>RelativeTimeFormat</span><span class="token punctuation">(</span><span class="token string">'zh'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> numeric<span class="token operator">:</span> <span class="token string">'auto'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '昨天'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">formatToParts</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → [{ type: 'literal', value: '昨天' }]</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'week'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '3周后'</span><br><br>rtf<span class="token punctuation">.</span><span class="token function">formatToParts</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'week'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → [</span><br><span class="token comment">//  { type: 'integer', value: '3', unit: 'week' },</span><br><span class="token comment">//  { type: 'literal', value: '周后' }</span><br><span class="token comment">// ]</span></code></pre><p>有关其余选项及其行为的详细信息，请参阅 <a href=https://github.com/tc39/proposal-intl-relative-time#api>API docs in the proposal repository</a>.<h2 id=conclusion>结论 <a href=#conclusion class=bookmark>#</a></h2><p><code>Intl.RelativeTimeFormat</code> 默认情况下在 V8 v7.1.179 和 Chrome 71 中可用。随着此 API 变得更加广泛可用，您将发现诸如 <a href=https://momentjs.com/ >Moment.js</a>, <a href=https://github.com/globalizejs/globalize>Globalize</a>, <a href=https://date-fns.org/docs/ >date-fns</a> 之类的库，会从代码库中移除对硬编码 CLDR 数据库的依赖性，而使用本机相对时间格式化功能，从而提高加载时性能、分析和编译时性能、运行时性能和内存使用。<h2 id=support><code>Intl.RelativeTimeFormat</code> support <a href=#support class=bookmark>#</a></h2><ul class=feature-support><li class="environment has-support has-link"><a href=/blog/v8-release-71#javascript-language-features><span class="icon chrome">Chrome:</span> <span class=support>自 <span class=version>71</span> 版本开始支持</span></a><li class="environment has-support"><span class="icon firefox">Firefox:</span> <span class=support>自 <span class=version>65</span> 版本开始支持</span><li class="environment has-support"><span class="icon safari">Safari:</span> <span class=support>自 <span class=version>14</span> 版本开始支持</span><li class="environment has-support has-link"><a href=https://twitter.com/mathias/status/1120700101637353473><span class="icon nodejs">Node.js:</span> <span class=support>自 <span class=version>12</span> 版本开始支持</span></a><li class="environment no-support"><span class="icon babel">Babel:</span> <span class=support>不支持</span></ul><div class=feature-support-info><a href=/features/support>关于特性支持列表</a></div></div><footer><div><picture><source srcset="/_img/avatars/mathias-bynens.avif, /_img/avatars/mathias-bynens@2x.avif 2x" type=image/avif><img alt="" height=96 src=/_img/avatars/mathias-bynens.jpg srcset="/_img/avatars/mathias-bynens@2x.jpg 2x" width=96 loading=lazy></picture><p>作者：Mathias Bynens (<a href=https://twitter.com/mathias>@mathias</a>).</div><a href=https://twitter.com/v8js/status/1054387117571354624 class=retweet>Retweet this article!</a></footer><footer><div><img alt="" height=96 src=/_img/avatars/justjavac.jpg srcset="/_img/avatars/justjavac@2x.jpg 2x" width=96 lazyload=on><p>译者：迷渡 (<a href=https://github.com/justjavac>@justjavac</a>)，V8.js.cn 站长.</div></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/features/intl-relativetimeformat>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/features/intl-relativetimeformat.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>