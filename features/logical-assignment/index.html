<!doctype html><html lang=zh-CN><meta charset=utf-8><title>Logical assignment · V8</title><meta content="width=device-width,initial-scale=1" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/_css/feature-support.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=' js'</script><meta content="JavaScript now supports compound assignment with logical operations." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li><a href=/blog/ >博客</a><li><a href=/docs/ >文档</a><li class=current><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>Logical assignment</h1><p class=meta>发布时间 <time datetime="2020-05-07 00:00:00" itemprop=datePublished>2020-05-07</time> · 标签： <a href=/features/tags/ecmascript class=tag>ECMAScript</a> <a href=/features/tags/es2021 class=tag>ES2021</a></header><div itemprop=articleBody><p>JavaScript supports a range of <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Assignment_Operators>compound assignment operators</a> that let programmers succinctly express a binary operation together with assignment. Currently, only mathematical or bitwise operations are supported.<p>What has been missing is the ability to combine logical operations with assignment. Until now! JavaScript now supports logical assignment with the new operators <code>&&=</code>, <code>||=</code>, and <code>??=</code>.<h2 id=logical-assignment-operators>Logical assignment operators <a href=#logical-assignment-operators class=bookmark>#</a></h2><p>Before we dive into the new operators, let’s have a refresher on the existing compound assignment operators. For instance, the meaning of <code>lhs += rhs</code> is roughly equivalent to <code>lhs = lhs + rhs</code>. This rough equivalence holds for all the existing operators <code>@=</code> where <code>@</code> stands in for a binary operator like <code>+</code>, or <code>|</code>. It is worth noting this is, strictly speaking, only correct when <code>lhs</code> is a variable. For more complex left-hand sides in expressions like <code>obj[computedPropertyName()] += rhs</code>, the left-hand side is only evaluated once.<p>Let’s now dive into the new operators. In contrast with the existing operators, <code>lhs @= rhs</code> does not roughly mean <code>lhs = lhs @ rhs</code> when <code>@</code> is a logical operation: <code>&&</code>, <code>||</code>, or <code>??</code>.<pre class=language-js><code class=language-js><span class="token comment">// As an additional review, here is the semantics of logical and:</span><br>x <span class="token operator">&&</span> y<br><span class="token comment">// → y when x is truthy</span><br><span class="token comment">// → x when x is not truthy</span><br><br><span class="token comment">// First, logical and assignment. The two lines following this</span><br><span class="token comment">// comment block are equivalent.</span><br><span class="token comment">// Note that like existing compound assignment operators, more complex</span><br><span class="token comment">// left-hand sides are only evaluated once.</span><br>x <span class="token operator">&&=</span> y<span class="token punctuation">;</span><br>x <span class="token operator">&&</span> <span class="token punctuation">(</span>x <span class="token operator">=</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// The semantics of logical or:</span><br>x <span class="token operator">||</span> y<br><span class="token comment">// → x when x is truthy</span><br><span class="token comment">// → y when x is not truthy</span><br><br><span class="token comment">// Similarly, logical or assignment:</span><br>x <span class="token operator">||=</span> y<span class="token punctuation">;</span><br>x <span class="token operator">||</span> <span class="token punctuation">(</span>x <span class="token operator">=</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// The semantics of nullish coalescing operator:</span><br>x <span class="token operator">??</span> y<br><span class="token comment">// → y when x is nullish (null or undefined)</span><br><span class="token comment">// → x when x is not nullish</span><br><br><span class="token comment">// Finally, nullish coalescing assignment:</span><br>x <span class="token operator">??=</span> y<span class="token punctuation">;</span><br>x <span class="token operator">??</span> <span class="token punctuation">(</span>x <span class="token operator">=</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id=short-circuit-semantics>Short-circuit semantics <a href=#short-circuit-semantics class=bookmark>#</a></h2><p>Unlike their mathematical and bitwise counterparts, logical assignments follow the short-circuiting behavior of their respective logical operations. They <em>only</em> perform an assignment if the logical operation would evaluate the right-hand side.<p>At first this may seem confusing. Why not unconditionally assign to the left-hand side like in other compound assignments?<p>There is a good practical reason for the difference. When combining logical operations with assignment, the assignment may cause a side-effect that should happen conditionally based on the result of that logical operation. Causing the side-effect unconditionally can negatively affect the performance or even correctness of the program.<p>Let’s make this concrete with an example of two versions of a function that sets a default message in an element.<pre class=language-js><code class=language-js><span class="token comment">// Display a default message if it doesn’t override anything.</span><br><span class="token comment">// Only assigns to innerHTML if it’s empty. Doesn’t cause inner</span><br><span class="token comment">// elements of msgElement to lose focus.</span><br><span class="token keyword">function</span> <span class="token function">setDefaultMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  msgElement<span class="token punctuation">.</span>innerHTML <span class="token operator">||=</span> <span class="token string">'&lt;p>No messages&lt;p>'</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Display a default message if it doesn’t override anything.</span><br><span class="token comment">// Buggy! May cause inner elements of msgElement to</span><br><span class="token comment">// lose focus every time it’s called.</span><br><span class="token keyword">function</span> <span class="token function">setDefaultMessageBuggy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  msgElement<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> msgElement<span class="token punctuation">.</span>innerHTML <span class="token operator">||</span> <span class="token string">'&lt;p>No messages&lt;p>'</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><div class=note><p><strong>Note:</strong> Because the <code>innerHTML</code> property is <a href=https://w3c.github.io/DOM-Parsing/#dom-innerhtml-innerhtml>specified</a> to return the empty string instead of <code>null</code> or <code>undefined</code>, <code>||=</code> must be used instead of <code>??=</code>. When writing code, keep in mind that many web APIs do not use <code>null</code> or <code>undefined</code> to mean empty or absent.</div><p>In HTML, assigning to the <code>.innerHTML</code> property on an element is destructive. Inner children are deleted, and new children parsed from the newly assigned string are inserted. Even when the new string is the same as the old string, it causes both additional work and the inner elements to lose focus. For this practical reason of not causing unwanted side-effects, the semantics of logical assignment operators short-circuit the assignment.<p>It may help to think about the symmetry with other compound assignment operators in the following way. Mathematical and bitwise operators are unconditional, and so the assignment is also unconditional. Logical operators are conditional, and so the assignment is also conditional.<h2 id=support>Logical assignment support <a href=#support class=bookmark>#</a></h2><ul class=feature-support><li class="environment has-support"><span class="icon chrome">Chrome:</span> <span class=support>自 <span class=version>85</span> 版本开始支持</span><li class="environment has-support has-link"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1629106"><span class="icon firefox">Firefox:</span> <span class=support>自 <span class=version>79</span> 版本开始支持</span></a><li class="environment has-support has-link"><a href="https://developer.apple.com/documentation/safari-release-notes/safari-14-beta-release-notes#New-Features:~:text=Added%2520logical%2520assignment%2520operator%2520support."><span class="icon safari">Safari:</span> <span class=support>自 <span class=version>14</span> 版本开始支持</span></a><li class="environment no-support"><span class="icon nodejs">Node.js:</span> <span class=support>不支持</span><li class="environment has-support has-link"><a href=https://babeljs.io/docs/en/babel-plugin-proposal-logical-assignment-operators><span class="icon babel">Babel:</span> <span class=support>支持</span></a></ul><div class=feature-support-info><a href=/features/support>关于特性支持列表</a></div></div><footer><div><picture><source srcset="/_img/avatars/shu-yu-guo.avif, /_img/avatars/shu-yu-guo@2x.avif 2x" type=image/avif><img alt="" height=96 loading=lazy src=/_img/avatars/shu-yu-guo.jpg srcset="/_img/avatars/shu-yu-guo@2x.jpg 2x" width=96></picture><p>作者：Shu-yu Guo (<a href=https://twitter.com/_shu>@_shu</a>).</div><a href=https://twitter.com/v8js/status/1258387483823345665 class=retweet>Retweet this article!</a></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/features/logical-assignment>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/features/logical-assignment.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>