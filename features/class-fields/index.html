<!doctype html><html lang=zh-CN><meta charset=utf-8><title>Public and private class fields · V8</title><meta content="width=device-width,initial-scale=1" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/_css/feature-support.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=' js'</script><meta content="Several proposals expand the existing JavaScript class syntax with new functionality. This article explains the new public class fields syntax in V8 v7.2 and Chrome 72, as well as the upcoming private class fields syntax." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li><a href=/blog/ >博客</a><li><a href=/docs/ >文档</a><li class=current><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>Public and private class fields</h1><p class=meta>发布时间 <time datetime="2018-12-13 00:00:00" itemprop=datePublished>2018-12-13</time> · 标签： <a href=/features/tags/ecmascript class=tag>ECMAScript</a></header><div itemprop=articleBody><p>Several proposals expand the existing JavaScript class syntax with new functionality. This article explains the new public class fields syntax in V8 v7.2 and Chrome 72, as well as the upcoming private class fields syntax.<p>Here’s a code example that creates an instance of a class named <code>IncreasingCounter</code>:<pre class=language-js><code class=language-js><span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IncreasingCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>counter<span class="token punctuation">.</span>value<span class="token punctuation">;</span><br><span class="token comment">// logs 'Getting the current value!'</span><br><span class="token comment">// → 0</span><br>counter<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>counter<span class="token punctuation">.</span>value<span class="token punctuation">;</span><br><span class="token comment">// logs 'Getting the current value!'</span><br><span class="token comment">// → 1</span></code></pre><p>Note that accessing the <code>value</code> executes some code (i.e., it logs a message) before returning the result. Now ask yourself, how would you implement this class in JavaScript? 🤔<h2 id=es2015-class-syntax>ES2015 class syntax <a href=#es2015-class-syntax class=bookmark>#</a></h2><p>Here’s how <code>IncreasingCounter</code> could be implemented using ES2015 class syntax:<pre class=language-js><code class=language-js><span class="token keyword">class</span> <span class="token class-name">IncreasingCounter</span> <span class="token punctuation">{</span><br>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>_count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">get</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Getting the current value!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_count<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>_count<span class="token operator">++</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>The class installs the <code>value</code> getter and an <code>increment</code> method on the prototype. More interestingly, the class has a constructor that creates an instance property <code>_count</code> and sets its default value to <code>0</code>. We currently tend to use the underscore prefix to denote that <code>_count</code> should not be used directly by consumers of the class, but that’s just a convention; it’s not <em>really</em> a “private” property with special semantics enforced by the language.<pre class=language-js><code class=language-js><span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IncreasingCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>counter<span class="token punctuation">.</span>value<span class="token punctuation">;</span><br><span class="token comment">// logs 'Getting the current value!'</span><br><span class="token comment">// → 0</span><br><br><span class="token comment">// Nothing stops people from reading or messing with the</span><br><span class="token comment">// `_count` instance property. 😢</span><br>counter<span class="token punctuation">.</span>_count<span class="token punctuation">;</span><br><span class="token comment">// → 0</span><br>counter<span class="token punctuation">.</span>_count <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span><br>counter<span class="token punctuation">.</span>value<span class="token punctuation">;</span><br><span class="token comment">// logs 'Getting the current value!'</span><br><span class="token comment">// → 42</span></code></pre><h2 id=public-class-fields>Public class fields <a href=#public-class-fields class=bookmark>#</a></h2><p>The new public class fields syntax allows us to simplify the class definition:<pre class=language-js><code class=language-js><span class="token keyword">class</span> <span class="token class-name">IncreasingCounter</span> <span class="token punctuation">{</span><br>  _count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>  <span class="token keyword">get</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Getting the current value!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_count<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>_count<span class="token operator">++</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>The <code>_count</code> property is now nicely declared at the top of the class. We no longer need a constructor just to define some fields. Neat!<p>However, the <code>_count</code> field is still a public property. In this particular example, we want to prevent people from accessing the property directly.<h2 id=private-class-fields>Private class fields <a href=#private-class-fields class=bookmark>#</a></h2><p>That’s where private class fields come in. The new private fields syntax is similar to public fields, except <a href=https://github.com/tc39/proposal-class-fields/blob/master/PRIVATE_SYNTAX_FAQ.md>you mark the field as being private by using <code>#</code></a>. You can think of the <code>#</code> as being part of the field name:<pre class=language-js><code class=language-js><span class="token keyword">class</span> <span class="token class-name">IncreasingCounter</span> <span class="token punctuation">{</span><br>  #count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>  <span class="token keyword">get</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Getting the current value!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#count<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>#count<span class="token operator">++</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>Private fields are not accessible outside of the class body:<pre class=language-js><code class=language-js><span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IncreasingCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>counter<span class="token punctuation">.</span>#count<span class="token punctuation">;</span><br><span class="token comment">// → SyntaxError</span><br>counter<span class="token punctuation">.</span>#count <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span><br><span class="token comment">// → SyntaxError</span></code></pre><h2 id=public-and-private-static-properties>Public and private static properties <a href=#public-and-private-static-properties class=bookmark>#</a></h2><p>Class fields syntax can be used to create public and private static properties and methods as well:<pre class=language-js><code class=language-js><span class="token keyword">class</span> <span class="token class-name">FakeMath</span> <span class="token punctuation">{</span><br>  <span class="token comment">// `PI` is a static public property.</span><br>  <span class="token keyword">static</span> <span class="token constant">PI</span> <span class="token operator">=</span> <span class="token number">22</span> <span class="token operator">/</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token comment">// Close enough.</span><br><br>  <span class="token comment">// `#totallyRandomNumber` is a static private property.</span><br>  <span class="token keyword">static</span> #totallyRandomNumber <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// `#computeRandomNumber` is a static private method.</span><br>  <span class="token keyword">static</span> <span class="token function">#computeRandomNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> FakeMath<span class="token punctuation">.</span>#totallyRandomNumber<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">// `random` is a static public method (ES2015 syntax)</span><br>  <span class="token comment">// that consumes `#computeRandomNumber`.</span><br>  <span class="token keyword">static</span> <span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'I heard you like random numbers…'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> FakeMath<span class="token punctuation">.</span><span class="token function">#computeRandomNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br>FakeMath<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">;</span><br><span class="token comment">// → 3.142857142857143</span><br>FakeMath<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// logs 'I heard you like random numbers…'</span><br><span class="token comment">// → 4</span><br>FakeMath<span class="token punctuation">.</span>#totallyRandomNumber<span class="token punctuation">;</span><br><span class="token comment">// → SyntaxError</span><br>FakeMath<span class="token punctuation">.</span><span class="token function">#computeRandomNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → SyntaxError</span></code></pre><h2 id=simpler-subclassing>Simpler subclassing <a href=#simpler-subclassing class=bookmark>#</a></h2><p>The benefits of the class fields syntax become even clearer when dealing with subclasses that introduce additional fields. Imagine the following base class <code>Animal</code>:<pre class=language-js><code class=language-js><span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span><br>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>To create a <code>Cat</code> subclass that introduces an additional instance property, you’d previously have to call <code>super()</code> to run the constructor of the <code>Animal</code> base class before creating the property:<pre class=language-js><code class=language-js><span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span><br>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>likesBaths <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token function">meow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Meow!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>That’s a lot of boilerplate just to indicate that cats don’t enjoy taking baths. Luckily, the class fields syntax removes the need for the whole constructor, including the awkward <code>super()</code> call:<pre class=language-js><code class=language-js><span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span><br>  likesBaths <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>  <span class="token function">meow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Meow!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h2 id=support>Feature support <a href=#support class=bookmark>#</a></h2><h3 id=support-public-fields>Support for public class fields <a href=#support-public-fields class=bookmark>#</a></h3><ul class=feature-support><li class="environment has-link has-support"><a href=/blog/v8-release-72#public-class-fields><span class="icon chrome">Chrome:</span> <span class=support>自 <span class=version>72</span> 版本开始支持</span></a><li class="environment has-link partial-support"><a href=https://developer.mozilla.org/en-US/docs/Mozilla/Firefox/Releases/69#JavaScript><span class="icon firefox">Firefox:</span> <span class=support>部分支持</span></a><li class="environment has-link partial-support"><a href="https://bugs.webkit.org/show_bug.cgi?id=174212"><span class="icon safari">Safari:</span> <span class=support>部分支持</span></a><li class="environment has-link has-support"><a href=https://twitter.com/mathias/status/1120700101637353473><span class="icon nodejs">Node.js:</span> <span class=support>自 <span class=version>12</span> 版本开始支持</span></a><li class="environment no-support"><span class="icon babel">Babel:</span> <span class=support>不支持</span></ul><div class=feature-support-info><a href=/features/support>关于特性支持列表</a></div><h3 id=support-private-fields>Support for private class fields <a href=#support-private-fields class=bookmark>#</a></h3><ul class=feature-support><li class="environment has-link has-support"><a href=/blog/v8-release-74#private-class-fields><span class="icon chrome">Chrome:</span> <span class=support>自 <span class=version>74</span> 版本开始支持</span></a><li class="environment no-support"><span class="icon firefox">Firefox:</span> <span class=support>不支持</span><li class="environment no-support"><span class="icon safari">Safari:</span> <span class=support>不支持</span><li class="environment has-link has-support"><a href=https://twitter.com/mathias/status/1120700101637353473><span class="icon nodejs">Node.js:</span> <span class=support>自 <span class=version>12</span> 版本开始支持</span></a><li class="environment no-support"><span class="icon babel">Babel:</span> <span class=support>不支持</span></ul><div class=feature-support-info><a href=/features/support>关于特性支持列表</a></div><h3 id=support-private-methods>Support for private methods and accessors <a href=#support-private-methods class=bookmark>#</a></h3><ul class=feature-support><li class="environment has-link has-support"><a href=/blog/v8-release-84#private-methods-and-accessors><span class="icon chrome">Chrome:</span> <span class=support>自 <span class=version>84</span> 版本开始支持</span></a><li class="environment no-support"><span class="icon firefox">Firefox:</span> <span class=support>不支持</span><li class="environment no-support"><span class="icon safari">Safari:</span> <span class=support>不支持</span><li class="environment no-support"><span class="icon nodejs">Node.js:</span> <span class=support>不支持</span><li class="environment no-support"><span class="icon babel">Babel:</span> <span class=support>不支持</span></ul><div class=feature-support-info><a href=/features/support>关于特性支持列表</a></div></div><footer><div><picture><source srcset="/_img/avatars/mathias-bynens.avif, /_img/avatars/mathias-bynens@2x.avif 2x" type=image/avif><img alt="" height=96 loading=lazy src=/_img/avatars/mathias-bynens.jpg srcset="/_img/avatars/mathias-bynens@2x.jpg 2x" width=96></picture><p>作者：Mathias Bynens (<a href=https://twitter.com/mathias>@mathias</a>).</div><a href=https://twitter.com/v8js/status/1121395767170740225 class=retweet>Retweet this article!</a></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/features/class-fields>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/features/class-fields.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>