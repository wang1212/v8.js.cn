<!doctype html><html lang=zh-CN><meta charset=utf-8><title>Class static initializer blocks · V8</title><meta content="width=device-width,initial-scale=1" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/_css/feature-support.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=' js'</script><meta content="JavaScript classes get dedicated syntax for static initialization." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li><a href=/blog/ >博客</a><li><a href=/docs/ >文档</a><li class=current><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>Class static initializer blocks</h1><p class=meta>发布时间 <time datetime="2021-03-30 00:00:00" itemprop=datePublished>2021-03-30</time> · 标签： <a href=/features/tags/ecmascript class=tag>ECMAScript</a></header><div itemprop=articleBody><p>The new class static initializer block syntax lets developers gather code that should run once for a given class definition and put them in a single place. Consider the following example where a pseudo-random number generator uses a static block to initialize an entropy pool once, when the <code>class MyPRNG</code> definition is evaluated.<pre class=language-js><code class=language-js><span class="token keyword">class</span> <span class="token class-name">MyPRNG</span> <span class="token punctuation">{</span><br>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">seed</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>seed <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>MyPRNG<span class="token punctuation">.</span>entropyPool<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Entropy pool exhausted'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>      seed <span class="token operator">=</span> MyPRNG<span class="token punctuation">.</span>entropyPool<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>seed <span class="token operator">=</span> seed<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> … <span class="token punctuation">}</span><br><br>  <span class="token keyword">static</span> entropyPool <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token keyword">static</span> <span class="token punctuation">{</span><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">512</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span>entropyPool<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">probeEntropySource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h2 id=scope>Scope <a href=#scope class=bookmark>#</a></h2><p>Each static initializer block is its own <code>var</code> and <code>let</code>/<code>const</code> scope. Like in static field initializers, the <code>this</code> value in static blocks is the class constructor itself. Similarly, <code>super.property</code> inside a static block refers to the super class’s static property.<pre class=language-js><code class=language-js><span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token string">'outer y'</span><span class="token punctuation">;</span><br><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span><br>  <span class="token keyword">static</span> fieldA <span class="token operator">=</span> <span class="token string">'A.fieldA'</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">A</span> <span class="token punctuation">{</span><br>  <span class="token keyword">static</span> fieldB <span class="token operator">=</span> <span class="token string">'B.fieldB'</span><span class="token punctuation">;</span><br>  <span class="token keyword">static</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span>fieldA<span class="token punctuation">;</span><br>    <span class="token comment">// → 'A.fieldA'</span><br>    <span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fieldB<span class="token punctuation">;</span><br>    <span class="token comment">// → 'B.fieldB'</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token comment">// Since static blocks are their own `var` scope, `var`s do not hoist!</span><br>y<span class="token punctuation">;</span><br><span class="token comment">// → 'outer y'</span></code></pre><h2 id=multiple-blocks>Multiple blocks <a href=#multiple-blocks class=bookmark>#</a></h2><p>A class may have more than one static initializer block. These blocks are evaluated in textual order. Additionally, if there are any static fields, all static elements are evaluated in textual order.<pre class=language-js><code class=language-js><span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token punctuation">{</span><br>  <span class="token keyword">static</span> field1 <span class="token operator">=</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'field 1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">static</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'static block 1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">static</span> field2 <span class="token operator">=</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'field 2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">static</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'static block 2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token comment">// → field 1</span><br><span class="token comment">//   static block 1</span><br><span class="token comment">//   field 2</span><br><span class="token comment">//   static block 2</span></code></pre><h2 id=access-to-private-fields>Access to private fields <a href=#access-to-private-fields class=bookmark>#</a></h2><p>Since a class static initializer block is always nested inside a class, it has access to that class’s private fields.<pre class=language-js><code class=language-js><span class="token keyword">let</span> getDPrivateField<span class="token punctuation">;</span><br><span class="token keyword">class</span> <span class="token class-name">D</span> <span class="token punctuation">{</span><br>  #privateField<span class="token punctuation">;</span><br>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>#privateField <span class="token operator">=</span> v<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">static</span> <span class="token punctuation">{</span><br>    <span class="token function function-variable">getDPrivateField</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d<span class="token punctuation">.</span>#privateField<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token function">getDPrivateField</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">D</span><span class="token punctuation">(</span><span class="token string">'private'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → private</span></code></pre><p>That’s about it. Happy object orienting!<h2 id=support>Class static initializer block support <a href=#support class=bookmark>#</a></h2><ul class=feature-support><li class="environment has-link has-support"><a href="https://bugs.chromium.org/p/v8/issues/detail?id=11375"><span class="icon chrome">Chrome:</span> <span class=support>自 <span class=version>91</span> 版本开始支持</span></a><li class="environment no-support"><span class="icon firefox">Firefox:</span> <span class=support>不支持</span><li class="environment no-support"><span class="icon safari">Safari:</span> <span class=support>不支持</span><li class="environment no-support"><span class="icon nodejs">Node.js:</span> <span class=support>不支持</span><li class="environment no-support"><span class="icon babel">Babel:</span> <span class=support>不支持</span></ul><div class=feature-support-info><a href=/features/support>关于特性支持列表</a></div></div><footer><div><picture><source srcset="/_img/avatars/shu-yu-guo.avif, /_img/avatars/shu-yu-guo@2x.avif 2x" type=image/avif><img alt="" height=96 loading=lazy src=/_img/avatars/shu-yu-guo.jpg srcset="/_img/avatars/shu-yu-guo@2x.jpg 2x" width=96></picture><p>作者：Shu-yu Guo (<a href=https://twitter.com/_shu>@_shu</a>).</div><a href=https://twitter.com/v8js/status/1376925666780798989 class=retweet>Retweet this article!</a></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/features/class-static-initializer-blocks>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/features/class-static-initializer-blocks.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>